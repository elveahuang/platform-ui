var ce=Object.defineProperty,fe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var H=(e,t,a)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,O=(e,t)=>{for(var a in t||(t={}))ve.call(t,a)&&H(e,a,t[a]);if(X)for(var a of X(t))ye.call(t,a)&&H(e,a,t[a]);return e},J=(e,t)=>fe(e,_e(t));var R=(e,t,a)=>(H(e,typeof t!="symbol"?t+"":t,a),a);var b=(e,t,a)=>new Promise((_,c)=>{var f=g=>{try{v(a.next(g))}catch(C){c(C)}},u=g=>{try{v(a.throw(g))}catch(C){c(C)}},v=g=>g.done?_(g.value):Promise.resolve(g.value).then(f,u);v((a=a.apply(e,t)).next())});import{a8 as be,a9 as he,aa as ge,ab as Ee,ac as Ce,ad as we,d as K,I as F,r as N,o as ae,l as Q,P as V,b as S,e as $,G as B,ae as Oe,S as ne,c as Ne,w as m,f as oe,Q as le,j as ie,af as Ae,ag as Re,H as Se,h as r,k as M,t as P,i as h,a4 as Te,F as Ue,T as $e,U as ke,v as Ie,M as Fe,N as Be,J as Le,K as De,ah as Me,L as Pe}from"./index-BeC3e9Y-.js";/* empty css                     *//* empty css                 *//* empty css                        *//* empty css                   *//* empty css                */import{B as Ve}from"./el-progress-Bzk5aJF9.js";/* empty css                  */import{u as qe}from"./data-table-K8IhbJ5d.js";/* empty css                        */import{_ as G}from"./AppIcon.vue_vue_type_script_setup_true_lang-Ddl_DFWV.js";import{A as xe}from"./index-Deri3loS.js";import{D as je,d as ze,a as He}from"./dict-DwKSRgcb.js";import{_ as Je}from"./DataTable.vue_vue_type_script_setup_true_lang-Cg-fagcS.js";import{A as Y}from"./attachment.type-DQU0bzuI.js";import{_ as Ge}from"./AEditor.vue_vue_type_script_setup_true_lang-B4QlGX9x.js";import"./index.min-DOEe5jHn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Ke(e,t){return be(t,function(a){return e[a]})}function Qe(e){return e==null?[]:Ke(e,he(e))}var We=Math.max;function Xe(e,t,a,_){e=ge(e)?e:Qe(e),a=a&&!_?Ee(a):0;var c=e.length;return a<0&&(a=We(c+a,0)),Ce(e)?a<=c&&e.indexOf(t,a)>-1:!!c&&we(e,t,a)>-1}const Ye=K({__name:"dict-select",props:{code:{type:String,required:!0},relation:{type:Object,required:!0,default:{targetId:0,targetType:"UNSPECIFIED",dictId:0,ids:[],items:[]}},multipleInd:{type:Boolean,required:!1,default:!1}},emits:["update:relation"],setup(e,{emit:t}){const a={true:"multiple",false:"combobox"},_=t,c=e,f=F(c.relation),u=F(new je),v=N([]),g=(o,E)=>E.label.toLowerCase().indexOf(o.toLowerCase())>=0,C=o=>b(this,null,function*(){c.multipleInd||(f.ids=[o]),_("update:relation",O({},f))});return ae(()=>b(this,null,function*(){Q("Component <<DictSelect>> mounted."),yield ze({code:c.code}).then(o=>{var E,y,w,k;f.dictId=(E=o.data)==null?void 0:E.id,f.targetType=(y=o.data)==null?void 0:y.code,o.data&&Object.assign(u,O({},o.data)),v.value=(k=(w=o.data)==null?void 0:w.children)==null?void 0:k.map(U=>({label:U.title,value:String(U.id)})),_("update:relation",O({},f))})})),(o,E)=>{const y=V("a-select");return S(),$(y,{"show-search":"",mode:a[`${c.multipleInd}`],value:f.ids,"onUpdate:value":E[0]||(E[0]=w=>f.ids=w),options:v.value,"filter-option":g,onChange:C},null,8,["mode","value","options"])}}});class se{static upload(t,a={}){return B(this.UPLOAD_FILE_URL,t,{headers:a})}}R(se,"UPLOAD_FILE_URL","/api/v1/attachment/upload");const Ze=e=>B("/api/v1/attachment/search",e),et={key:0},tt=ie("div",{class:"ant-upload-text"},"Upload",-1),Z=K({__name:"file-upload",props:{code:{type:String,required:!0},attachment:{type:Object,required:!1,default:{targetId:0,targetType:"",attachmentType:{multiple:!1},fileList:[]}},action:{type:String,required:!1,default:Oe.server+"/api/v1/attachment/upload"},directory:{type:Boolean,required:!1,default:!1},disabled:{type:Boolean,required:!1,default:!1},multiple:{type:Boolean,required:!1,default:!1},maxCount:{type:Number,required:!1,default:99},maxSize:{type:Number,required:!1,default:10240}},emits:["update:attachment"],setup(e,{emit:t}){var U;const a=t,_=e,c=N(!1),f=N(_.multiple),u=F(_.attachment),v=N(!ne(u.fileList)&&((U=u.fileList)==null?void 0:U.map(n=>JSON.parse(n.extra)))||[]),g=Ne(()=>f.value?v.value.length<_.maxCount:v.value.length<1),C=n=>b(this,null,function*(){const d=Xe(u.attachmentType.fileTypes,n==null?void 0:n.type),l=n.size/1024/1024<_.maxSize;return!d&&message.error(`File type incorrect! should be inside [${u.attachmentType.fileTypes.join(", ")}]`),!l&&message.error(`Image must smaller than ${_.maxSize}MB!`),d&&l}),o=(n,d)=>{const l=new FileReader;l.addEventListener("load",()=>d(l.result)),l.readAsDataURL(n)},E=n=>{if(n.file.status==="uploading"){c.value=!0;return}n.file.status==="done"&&o(n.file.originFileObj,d=>{c.value=!1}),n.file.status==="error"&&(c.value=!1,message.error("upload error"))},y=n=>b(this,null,function*(){const d=new FormData;d.append("targetType",_.code),d.append("attachmentType",_.code),d.append(n.filename,n.file),n.data&&Object.keys(n.data).forEach(l=>{d.append(l,n.data[l])}),se.upload(d).then(l=>{n.onSuccess(l,n.file),u.fileList=v.value.map(T=>J(O({},T.response.data[0]),{extra:JSON.stringify(T)})),a("update:attachment",O({},u))}).catch(l=>{n.onError(l,l,n.file),message.error(n.file.name+l)})}),w=n=>{var d;return u.fileList=(d=v.value.filter(l=>n.uid!==l.uid))==null?void 0:d.map(l=>J(O({},l.response.data[0]),{extra:JSON.stringify(l)})),a("update:attachment",O({},u)),!0},k=n=>{window.open(n.response.data[0].url)};return ae(()=>b(this,null,function*(){Q("Component <<FileUpload>> mounted."),yield Ze({code:_.code}).then(n=>{var d,l;u.targetType=(d=n.data)==null?void 0:d.code,u.attachmentType=O({},n.data),f.value=(l=u.attachmentType)==null?void 0:l.multipleInd,a("update:attachment",O({},u))})})),(n,d)=>{var L;const l=V("loading-outlined"),T=V("plus-outlined"),q=Ae;return S(),$(q,{"file-list":v.value,"onUpdate:fileList":d[0]||(d[0]=x=>v.value=x),name:"attachment","list-type":"picture-card",action:e.action,multiple:f.value&&u.attachmentType.multipleInd,"custom-request":y,"before-upload":C,accept:`.${(L=u.attachmentType)==null?void 0:L.ext.join(",.")}`,"on-reject":w,onPreview:k,onRemove:w,onChange:E},{default:m(()=>[g.value?(S(),oe("div",et,[c.value?(S(),$(l,{key:0})):(S(),$(T,{key:1})),tt])):le("",!0)]),_:1},8,["file-list","action","multiple","accept"])}}}),at=e=>B("/api/v1/admin/banner/list",e),nt=e=>Re("/api/v1/admin/banner/save",e),ot=e=>B("/api/v1/admin/banner/details",e),lt=e=>B("/api/v1/admin/banner/delete",e);class ee extends Ve{constructor(){super(...arguments);R(this,"title","");R(this,"type",new He);R(this,"cover",new Y);R(this,"mobileCover",new Y);R(this,"sortOrder",999);R(this,"description","");R(this,"startDatetime","");R(this,"endDatetime","")}}const te={UNSPECIFIED:"UNSPECIFIED",USER_AVATAR:"USER_AVATAR",BANNER_COVER:"BANNER_COVER",BANNER_MOBILE_COVER:"BANNER_MOBILE_COVER"},it={UNSPECIFIED:"UNSPECIFIED",BANNER:"BANNER"},st=["innerHTML"],Rt=K({__name:"index",setup(e){const{t}=Se(),{initialize:a,handleResult:_,handleParams:c}=qe(),f=N(),u=N(!1),v=()=>b(this,null,function*(){yield at(c(C)).then(s=>{_(C,s)})}),g=[{title:t("common.serial_number"),dataIndex:"sortOrder",key:"sortOrder",width:100,ellipsis:!0,sorter:!0},{title:t("common.field_title"),dataIndex:"title",key:"title",width:150,ellipsis:!0,sorter:!0},{title:t("common.field_last_modified_at"),dataIndex:"lastModifiedAt",key:"lastModifiedAt",width:120,sorter:!0,ellipsis:!0},{title:t("common.label_action"),dataIndex:"operation",key:"operation",width:50,ellipsis:!0,fixed:"right"}],C=F(a(g)),o=F(new ee),E=N(""),y=N(!1),w=N(),k=s=>b(this,null,function*(){var i;(i=w.value)==null||i.clearValidate(),s&&s>0?(E.value=t("common.banner_edit"),yield ot({id:s}).then(A=>{y.value=!0,Object.assign(o,O({},A.data))})):(E.value=t("common.banner_add"),Object.assign(o,new ee),y.value=!0)}),U=()=>b(this,null,function*(){yield w.value.validate().then(()=>b(this,null,function*(){nt(o).then(s=>{s.code=="200"&&(y.value=!1,f.value.refresh())})})).catch(s=>{Q(s)})}),n=()=>{y.value=!1};F({title:[{required:!0,message:t("common.field_title_validation")}]});const d=(s=0)=>b(this,null,function*(){const i=s>0?[s]:f.value.selectedRowKeys();if(ne(i)){$e({message:t("common.label_please_select_one_record")}).then();return}lt({ids:i}).then(A=>{A.code=="200"&&(y.value=!1,f.value.refresh())})}),l=N(!1),T=N(""),q=s=>b(this,null,function*(){T.value=s.description,l.value=!0}),L=()=>b(this,null,function*(){T.value="",l.value=!1}),x=()=>b(this,null,function*(){T.value="",l.value=!1});return(s,i)=>{const A=ke,re=V("a-popconfirm"),de=Ie,j=Fe,W=Be,me=Le,I=De,ue=Me,pe=Pe;return S(),oe(Ue,null,[r(h(xe),null,{title:m(()=>[M(P(s.$t("common.banner_management")),1)]),_:1}),r(j,null,{default:m(()=>[r(h(Je),{ref_key:"dataTableRef",ref:f,model:C,"onUpdate:model":i[3]||(i[3]=p=>C=p),onGetDataList:v,"row-selection-enabled":u.value,"tool-bar-enabled":!0},{toolBar:m(()=>[r(A,{type:"primary",onClick:i[0]||(i[0]=p=>k(0))},{default:m(()=>[M(P(s.$t("common.banner_add")),1)]),_:1}),r(A,{onClick:i[1]||(i[1]=p=>u.value=!u.value)},{default:m(()=>[M(P(u.value?s.$t("common.label_batch_operation_cancel"):s.$t("common.label_batch_operation")),1)]),_:1}),r(A,{danger:"",onClick:i[2]||(i[2]=p=>d(0))},{default:m(()=>[M(P(s.$t("common.button_delete")),1)]),_:1})]),bodyCell:m(({column:p,record:D})=>[p.dataIndex==="operation"?(S(),$(de,{key:0},{default:m(()=>[r(A,{type:"primary",size:"small",onClick:z=>q(D)},{icon:m(()=>[r(h(G),{icon:"mdi:eye-outline"})]),_:2},1032,["onClick"]),r(A,{type:"primary",size:"small",onClick:z=>k(D.id)},{icon:m(()=>[r(h(G),{icon:"ant-design:edit-outlined"})]),_:2},1032,["onClick"]),r(re,{title:s.$t("common.label_confirm_delete_record"),onConfirm:z=>d(D.id)},{default:m(()=>[r(A,{danger:"",type:"primary",size:"small",onConfirm:z=>d(D.id)},{icon:m(()=>[r(h(G),{icon:"ant-design:close-outlined"})]),_:2},1032,["onConfirm"])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):le("",!0)]),_:1},8,["model","row-selection-enabled"])]),_:1}),r(W,{class:"app-modal",open:l.value,"onUpdate:open":i[4]||(i[4]=p=>l.value=p),title:s.$t("common.label_preview"),onOk:L,onCancel:x},{default:m(()=>[r(j,null,{default:m(()=>[ie("div",{innerHTML:T.value},null,8,st)]),_:1})]),_:1},8,["open","title"]),r(W,{class:"app-modal",open:y.value,"onUpdate:open":i[11]||(i[11]=p=>y.value=p),title:E.value,onOk:U,onCancel:n},{default:m(()=>[r(j,null,{default:m(()=>[r(pe,Te({ref_key:"entityForm",ref:w,model:o,rules:s.entityFormRules,onFinish:U},{labelCol:{span:4},wrapperCol:{span:16}}),{default:m(()=>[r(I,{name:"title",label:s.$t("common.field_title")},{default:m(()=>[r(me,{value:o.title,"onUpdate:value":i[5]||(i[5]=p=>o.title=p),placeholder:h(t)("common.field_title_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),r(I,{name:"type",label:s.$t("common.field_type")},{default:m(()=>[(S(),$(h(Ye),{"multiple-ind":!0,key:o.id,relation:o.type,"onUpdate:relation":i[6]||(i[6]=p=>o.type=p),code:h(it).BANNER},null,8,["relation","code"]))]),_:1},8,["label"]),r(I,{name:"description",label:s.$t("common.field_content")},{default:m(()=>[r(h(Ge),{value:o.description,"onUpdate:value":i[7]||(i[7]=p=>o.description=p)},null,8,["value"])]),_:1},8,["label"]),r(I,{name:"idx",label:s.$t("common.serial_number")},{default:m(()=>[r(ue,{max:999,min:0,value:o.sortOrder,"onUpdate:value":i[8]||(i[8]=p=>o.sortOrder=p),placeholder:h(t)("common.input_serial_number")},null,8,["value","placeholder"])]),_:1},8,["label"]),r(I,{name:"cover",label:s.$t("common.field_cover")},{default:m(()=>[(S(),$(h(Z),{key:o.id,attachment:o.cover,"onUpdate:attachment":i[9]||(i[9]=p=>o.cover=p),code:h(te).BANNER_COVER},null,8,["attachment","code"]))]),_:1},8,["label"]),r(I,{name:"mobileCover",label:s.$t("common.field_mobile_cover")},{default:m(()=>[(S(),$(h(Z),{key:o.id,attachment:o.mobileCover,"onUpdate:attachment":i[10]||(i[10]=p=>o.mobileCover=p),code:h(te).BANNER_MOBILE_COVER},null,8,["attachment","code"]))]),_:1},8,["label"])]),_:1},16,["model","rules"])]),_:1})]),_:1},8,["open","title"])],64)}}});export{Rt as default};
