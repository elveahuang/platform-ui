var u=(f,t,n)=>new Promise((_,e)=>{var i=l=>{try{a(n.next(l))}catch(m){e(m)}},p=l=>{try{a(n.throw(l))}catch(m){e(m)}},a=l=>l.done?_(l.value):Promise.resolve(l.value).then(i,p);a((n=n.apply(f,t)).next())});import{d as C,z as E,r as v,o as V,l as r,b as k,e as x,w as s,k as $,t as y,D as M,M as U,h as o,dy as A,G as q,A as B,dx as O,j as N,i as h,aL as b}from"./index-DeCV1DJj.js";import{b as P}from"./user-D32MYL7s.js";import{a as S}from"./captcha-B1Abs9eH.js";import"./index-BgA6CSr0.js";import"./ThemeDropdown.vue_vue_type_style_index_0_scoped_8799785f_lang-iZ5X_zze.js";import{I as j,b as D}from"./index-Czbya3Ao.js";import{_ as F,F as z}from"./index-CUj_EZ7-.js";import{C as G}from"./index-Cne_Kuws.js";import"./index-kE048MwQ.js";import"./index-Y-looTN2.js";import"./shallowequal-Dq94QeDq.js";import"./EyeOutlined-BehfxjaI.js";import"./Col-Bf7r7NTM.js";import"./responsiveObserve-DM4oKiVb.js";import"./useFlexGapSupport-z3FA5emY.js";import"./isMobile-DTq5YDvJ.js";import"./useMergedState-CwEz_eMQ.js";const L=C({__name:"MailCaptcha",props:{email:{type:String,default:""}},emits:["change"],setup(f,{emit:t}){const{t:n}=E(),_=t,e=f,i=v(!1),p=v(n("common.field_captcha_button"));let a=0,l=null;const m=()=>u(this,null,function*(){if(r("获取邮箱验证码"),r(e.email),M(e.email)){r("邮箱为空"),U.confirm({icon:o(A),content:o("div",{style:"color:red;"},n("common.field_captcha_validation_email")),onOk(){console.log("OK")},onCancel(){console.log("Cancel")},class:"test"});return}yield S({email:e.email}).then(c=>{_("change",c.data.key),i.value=!0,a=60,l=setInterval(()=>{a--,a<=0?(p.value=n("common.field_captcha_button"),i.value=!1,clearInterval(l)):p.value=n("common.field_captcha_tip",{time:a})},1e3)})});return V(()=>u(this,null,function*(){r("Component <<MailCaptcha>> mounted.")})),(c,g)=>{const w=q;return k(),x(w,{style:{"min-width":"100px"},type:"primary",disabled:i.value,onClick:m},{default:s(()=>[$(y(p.value),1)]),_:1},8,["disabled"])}}}),re=C({__name:"email",setup(f){const{t}=E(),n=v(),_={password:[{required:!0,message:t("common.user_field_password_placeholder")}],newEmail:[{required:!0,message:t("common.user_field_new_email_validation")}],captchaValue:[{required:!0,message:t("common.field_captcha_placeholder")}]},e=B({email:"",password:"",newEmail:"",captchaKey:"",captchaValue:""}),i=a=>u(this,null,function*(){e.captchaKey=a}),p=()=>u(this,null,function*(){P({email:e.email,password:e.password,newEmail:e.newEmail,captchaKey:e.captchaKey,captchaValue:e.captchaValue}).then(a=>{a.code==200?b.success(t("common.modify_success")):b.error(t("common.modify_fail"))}).catch(a=>{r(a),b.error(t("common.system_error"))})});return V(()=>u(this,null,function*(){r("Page <<UserCenterPasswordPage>> mounted."),O().then(a=>{r("用户信息结果："),r(a.data),Object.assign(e,a.data)}).catch(a=>{})})),(a,l)=>{const m=j,c=F,g=D,w=q,I=z,K=G;return k(),x(K,{shadow:"never"},{title:s(()=>[N("div",null,y(a.$t("common.user_pages_change_email_title")),1)]),default:s(()=>[o(I,{ref_key:"form",ref:n,model:e,rules:_,"label-width":"200px",style:{"max-width":"500px"}},{default:s(()=>[o(c,{name:"email","label-col":{span:4},label:a.$t("common.user_field_current_email")},{default:s(()=>[o(m,{value:e.email,"onUpdate:value":l[0]||(l[0]=d=>e.email=d),disabled:!0,placeholder:e.email},null,8,["value","placeholder"])]),_:1},8,["label"]),o(c,{name:"password",required:!0,"label-col":{span:4},label:a.$t("common.user_field_password")},{default:s(()=>[o(m,{type:"password",value:e.password,"onUpdate:value":l[1]||(l[1]=d=>e.password=d),placeholder:h(t)("common.user_field_password")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(c,{name:"newEmail",required:!0,"label-col":{span:4},label:a.$t("common.user_field_new_email_placeholder")},{default:s(()=>[o(g,{compact:""},{default:s(()=>[o(m,{value:e.newEmail,"onUpdate:value":l[2]||(l[2]=d=>e.newEmail=d),placeholder:h(t)("common.user_field_email_validation"),style:{width:"calc(100% - 100px)"}},null,8,["value","placeholder"]),o(h(L),{email:e.newEmail,onChange:i},null,8,["email"])]),_:1})]),_:1},8,["label"]),o(c,{name:"captchaValue",required:!0,"label-col":{span:4},label:a.$t("common.field_captcha")},{default:s(()=>[o(m,{value:e.captchaValue,"onUpdate:value":l[3]||(l[3]=d=>e.captchaValue=d),placeholder:h(t)("common.field_captcha_placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(c,{colon:!1,"label-col":{span:16}},{label:s(()=>[o(w,{class:"!w-36",onClick:p,type:"primary"},{default:s(()=>[$(y(a.$t("common.button_submit")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}});export{re as default};
