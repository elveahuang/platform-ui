var D=(e,o,n)=>new Promise((u,s)=>{var d=c=>{try{r(n.next(c))}catch(g){s(g)}},m=c=>{try{r(n.throw(c))}catch(g){s(g)}},r=c=>c.done?u(c.value):Promise.resolve(c.value).then(d,m);r((n=n.apply(e,o)).next())});import{a7 as ve,a8 as he,a9 as B,aa as ge,c as L,V as be,ab as E,ac as G,d as Q,n as Y,ad as $,ae as V,r as C,af as pe,B as T,ag as le,e as se,ah as Oe,ai as ce,f,p as ie,aj as W,ak as _,t as Te,$ as xe,u as ye,al as ke,X as j,am as q,an as we,ao as Z,a2 as Ce,_ as ee,ap as Ee,w as Se}from"./index-104d3409.js";const Ie=e=>D(void 0,null,function*(){B.mode==="legacy"?B.global.locale=e:B.global.locale.value=e}),Pe=e=>D(void 0,null,function*(){B.global.setLocaleMessage(e,yield ge(e))}),Me=e=>D(void 0,null,function*(){yield ve().setLocale(e),yield Pe(e),yield Ie(e),yield he(e)}),Xe=()=>({changeLocale:Me}),[He,p,te]=L("picker"),ue=e=>e.find(o=>!o.disabled)||e[0];function Ne(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function X(e,o){o=G(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ne=(e,o,n)=>o!==void 0&&!!e.find(u=>u[n.value]===o);function J(e,o,n){const u=e.findIndex(d=>d[n.value]===o),s=X(e,u);return e[s]}function De(e,o,n){const u=[];let s={[o.children]:e},d=0;for(;s&&s[o.children];){const m=s[o.children],r=n.value[d];if(s=be(r)?J(m,r,o):void 0,!s&&m.length){const c=ue(m)[o.value];s=J(m,c,o)}d++,u.push(m)}return u}function $e(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function Be(e){return E({text:"text",value:"value",children:"children"},e)}const ae=200,oe=300,_e=15,[re,z]=L("picker-column"),de=Symbol(re);var Ve=Q({name:re,props:{value:Y,fields:$(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:$(Number),swipeDuration:$(Y),visibleOptionNum:$(Y)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:n}){let u,s,d,m,r;const c=C(),g=C(),v=C(0),h=C(0),y=pe(),S=()=>e.options.length,M=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,x=i=>{const t=X(e.options,i),a=-t*e.optionHeight,l=()=>{const O=e.options[t][e.fields.value];O!==e.value&&o("change",O)};u&&a!==v.value?r=l:l(),v.value=a},b=()=>e.readonly||!e.options.length,R=i=>{u||b()||(r=null,h.value=ae,x(i),o("clickOption",e.options[i]))},k=i=>G(Math.round(-i/e.optionHeight),0,S()-1),H=T(()=>k(v.value)),F=(i,t)=>{const a=Math.abs(i/t);i=v.value+a/.003*(i<0?-1:1);const l=k(i);h.value=+e.swipeDuration,x(l)},N=()=>{u=!1,h.value=0,r&&(r(),r=null)},K=i=>{if(!b()){if(y.start(i),u){const t=$e(g.value);v.value=Math.min(0,t-M())}h.value=0,s=v.value,d=Date.now(),m=s,r=null}},U=i=>{if(b())return;y.move(i),y.isVertical()&&(u=!0,ie(i,!0));const t=G(s+y.deltaY.value,-(S()*e.optionHeight),e.optionHeight),a=k(t);a!==H.value&&o("scrollInto",e.options[a]),v.value=t;const l=Date.now();l-d>oe&&(d=l,m=t)},I=()=>{if(b())return;const i=v.value-m,t=Date.now()-d;if(t<oe&&Math.abs(i)>_e){F(i,t);return}const l=k(v.value);h.value=ae,x(l),setTimeout(()=>{u=!1},0)},w=()=>{const i={height:`${e.optionHeight}px`};return e.options.map((t,a)=>{const l=t[e.fields.text],{disabled:O}=t,P=t[e.fields.value],me={role:"button",style:i,tabindex:O?-1:0,class:[z("item",{disabled:O,selected:P===e.value}),t.className],onClick:()=>R(a)},fe={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return f("li",me,[n.option?n.option(t,a):f("div",fe,null)])})};return le(de),se({stopMomentum:N}),Oe(()=>{const i=e.options.findIndex(l=>l[e.fields.value]===e.value),a=-X(e.options,i)*e.optionHeight;v.value=a}),ce("touchmove",U,{target:c}),()=>f("div",{ref:c,class:z(),onTouchstartPassive:K,onTouchend:I,onTouchcancel:I},[f("ul",{ref:g,style:{transform:`translate3d(0, ${v.value+M()}px, 0)`,transitionDuration:`${h.value}ms`,transitionProperty:h.value?"all":"none"},class:z("wrapper"),onTransitionend:N},[w()])])}});const[Le]=L("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},Ae=["cancel","confirm","title","toolbar"],Re=Object.keys(A);var Fe=Q({name:Le,props:A,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const u=()=>{if(n.title)return n.title();if(e.title)return f("div",{class:[p("title"),"van-ellipsis"]},[e.title])},s=()=>o("cancel"),d=()=>o("confirm"),m=()=>{const c=e.cancelButtonText||te("cancel");return f("button",{type:"button",class:[p("cancel"),W],onClick:s},[n.cancel?n.cancel():c])},r=()=>{const c=e.confirmButtonText||te("confirm");return f("button",{type:"button",class:[p("confirm"),W],onClick:d},[n.confirm?n.confirm():c])};return()=>f("div",{class:p("toolbar")},[n.toolbar?n.toolbar():[m(),u(),r()]])}});const[Ke,Je]=L("picker-group"),Ue=Symbol(Ke);E({tabs:V(),activeTab:_(0),nextStepText:String},A);const Ye=E({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:_(44),showToolbar:Te,swipeDuration:_(1e3),visibleOptionNum:_(6)},A),je=E({},Ye,{columns:V(),modelValue:V(),toolbarPosition:xe("top"),columnsFieldNames:Object});var qe=Q({name:He,props:je,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const u=C(),s=C(e.modelValue.slice(0)),{parent:d}=le(Ue),{children:m,linkChildren:r}=ye(de);r();const c=T(()=>Be(e.columnsFieldNames)),g=T(()=>ke(e.optionHeight)),v=T(()=>Ne(e.columns,c.value)),h=T(()=>{const{columns:t}=e;switch(v.value){case"multiple":return t;case"cascade":return De(t,c.value,s);default:return[t]}}),y=T(()=>h.value.some(t=>t.length)),S=T(()=>h.value.map((t,a)=>J(t,s.value[a],c.value))),M=T(()=>h.value.map((t,a)=>t.findIndex(l=>l[c.value.value]===s.value[a]))),x=(t,a)=>{if(s.value[t]!==a){const l=s.value.slice(0);l[t]=a,s.value=l}},b=()=>({selectedValues:s.value.slice(0),selectedOptions:S.value,selectedIndexes:M.value}),R=(t,a)=>{x(a,t),v.value==="cascade"&&s.value.forEach((l,O)=>{const P=h.value[O];ne(P,l,c.value)||x(O,P.length?P[0][c.value.value]:void 0)}),ee(()=>{o("change",E({columnIndex:a},b()))})},k=(t,a)=>{const l={columnIndex:a,currentOption:t};o("clickOption",E(b(),l)),o("scrollInto",l)},H=()=>{m.forEach(a=>a.stopMomentum());const t=b();return ee(()=>{o("confirm",t)}),t},F=()=>o("cancel",b()),N=()=>h.value.map((t,a)=>f(Ve,{value:s.value[a],fields:c.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:g.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>R(l,a),onClickOption:l=>k(l,a),onScrollInto:l=>{o("scrollInto",{currentOption:l,columnIndex:a})}},{option:n.option})),K=t=>{if(y.value){const a={height:`${g.value}px`},l={backgroundSize:`100% ${(t-g.value)/2}px`};return[f("div",{class:p("mask"),style:l},null),f("div",{class:[Ee,p("frame")],style:a},null)]}},U=()=>{const t=g.value*+e.visibleOptionNum,a={height:`${t}px`};return f("div",{ref:u,class:p("columns"),style:a},[N(),K(t)])},I=()=>{if(e.showToolbar&&!d)return f(Fe,Ce(Z(e,Re),{onConfirm:H,onCancel:F}),Z(n,Ae))};j(h,t=>{t.forEach((a,l)=>{a.length&&!ne(a,s.value[l],c.value)&&x(l,ue(a)[c.value.value])})},{immediate:!0});let w;return j(()=>e.modelValue,t=>{!q(t,s.value)&&!q(t,w)&&(s.value=t.slice(0),w=t.slice(0))},{deep:!0}),j(s,t=>{q(t,e.modelValue)||(w=t.slice(0),o("update:modelValue",w))},{immediate:!0}),ce("touchmove",ie,{target:u}),se({confirm:H,getSelectedOptions:()=>S.value}),()=>{var t,a;return f("div",{class:p()},[e.toolbarPosition==="top"?I():null,e.loading?f(we,{class:p("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),U(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?I():null])}}});const Qe=Se(qe);export{Qe as P,Xe as u};
