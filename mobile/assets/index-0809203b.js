import{a7 as e,a8 as t,a9 as l,aa as o,c as a,V as n,ab as i,ac as s,d as c,n as u,ad as r,ae as v,r as d,af as p,B as m,ag as f,e as h,ah as g,ai as b,f as w,p as x,aj as y,ak as O,t as k,$ as H,u as I,al as T,X as N,am as S,an as B,ao as C,a2 as D,_ as V,ap as M,w as $}from"./index-d10a1838.js";const P=async a=>{const n=e();await n.setLocale(a),await(async e=>{l.global.setLocaleMessage(e,await o(e))})(a),await(async e=>{"legacy"===l.mode?l.global.locale=e:l.global.locale.value=e})(a),await t(a)},j=()=>({changeLocale:P}),[L,E,A]=a("picker"),F=e=>e.find((e=>!e.disabled))||e[0];function z(e,t){for(let l=t=s(t,0,e.length);l<e.length;l++)if(!e[l].disabled)return l;for(let l=t-1;l>=0;l--)if(!e[l].disabled)return l;return 0}const X=(e,t,l)=>void 0!==t&&!!e.find((e=>e[l.value]===t));function Y(e,t,l){const o=e.findIndex((e=>e[l.value]===t));return e[z(e,o)]}const[_,q]=a("picker-column"),G=Symbol(_);var J=c({name:_,props:{value:u,fields:r(Object),options:v(),readonly:Boolean,allowHtml:Boolean,optionHeight:r(Number),swipeDuration:r(u),visibleOptionNum:r(u)},emits:["change","clickOption","scrollInto"],setup(e,{emit:t,slots:l}){let o,a,n,i,c;const u=d(),r=d(),v=d(0),y=d(0),O=p(),k=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,I=l=>{const a=z(e.options,l),n=-a*e.optionHeight,i=()=>{const l=e.options[a][e.fields.value];l!==e.value&&t("change",l)};o&&n!==v.value?c=i:i(),v.value=n},T=()=>e.readonly||!e.options.length,N=t=>s(Math.round(-t/e.optionHeight),0,k()-1),S=m((()=>N(v.value))),B=()=>{o=!1,y.value=0,c&&(c(),c=null)},C=e=>{if(!T()){if(O.start(e),o){const e=function(e){const{transform:t}=window.getComputedStyle(e),l=t.slice(7,t.length-1).split(", ")[5];return Number(l)}(r.value);v.value=Math.min(0,e-H())}y.value=0,a=v.value,n=Date.now(),i=a,c=null}},D=()=>{if(T())return;const t=v.value-i,l=Date.now()-n;if(l<300&&Math.abs(t)>15)return void((t,l)=>{const o=Math.abs(t/l);t=v.value+o/.003*(t<0?-1:1);const a=N(t);y.value=+e.swipeDuration,I(a)})(t,l);const a=N(v.value);y.value=200,I(a),setTimeout((()=>{o=!1}),0)},V=()=>{const a={height:`${e.optionHeight}px`};return e.options.map(((n,i)=>{const s=n[e.fields.text],{disabled:u}=n,r=n[e.fields.value],v={role:"button",style:a,tabindex:u?-1:0,class:[q("item",{disabled:u,selected:r===e.value}),n.className],onClick:()=>(l=>{o||T()||(c=null,y.value=200,I(l),t("clickOption",e.options[l]))})(i)},d={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:s};return w("li",v,[l.option?l.option(n,i):w("div",d,null)])}))};return f(G),h({stopMomentum:B}),g((()=>{const t=e.options.findIndex((t=>t[e.fields.value]===e.value)),l=-z(e.options,t)*e.optionHeight;v.value=l})),b("touchmove",(l=>{if(T())return;O.move(l),O.isVertical()&&(o=!0,x(l,!0));const c=s(a+O.deltaY.value,-k()*e.optionHeight,e.optionHeight),u=N(c);u!==S.value&&t("scrollInto",e.options[u]),v.value=c;const r=Date.now();r-n>300&&(n=r,i=c)}),{target:u}),()=>w("div",{ref:u,class:q(),onTouchstartPassive:C,onTouchend:D,onTouchcancel:D},[w("ul",{ref:r,style:{transform:`translate3d(0, ${v.value+H()}px, 0)`,transitionDuration:`${y.value}ms`,transitionProperty:y.value?"all":"none"},class:q("wrapper"),onTransitionend:B},[V()])])}});const[K]=a("picker-toolbar"),Q={title:String,cancelButtonText:String,confirmButtonText:String},R=["cancel","confirm","title","toolbar"],U=Object.keys(Q);var W=c({name:K,props:Q,emits:["confirm","cancel"],setup(e,{emit:t,slots:l}){const o=()=>t("cancel"),a=()=>t("confirm"),n=()=>{const t=e.cancelButtonText||A("cancel");return w("button",{type:"button",class:[E("cancel"),y],onClick:o},[l.cancel?l.cancel():t])},i=()=>{const t=e.confirmButtonText||A("confirm");return w("button",{type:"button",class:[E("confirm"),y],onClick:a},[l.confirm?l.confirm():t])};return()=>w("div",{class:E("toolbar")},[l.toolbar?l.toolbar():[n(),l.title?l.title():e.title?w("div",{class:[E("title"),"van-ellipsis"]},[e.title]):void 0,i()]])}});const[Z,ee]=a("picker-group"),te=Symbol(Z);i({tabs:v(),nextStepText:String},Q);const le=i({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:O(44),showToolbar:k,swipeDuration:O(1e3),visibleOptionNum:O(6)},Q);const oe=$(c({name:L,props:i({},le,{columns:v(),modelValue:v(),toolbarPosition:H("top"),columnsFieldNames:Object}),emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:t,slots:l}){const o=d(),a=d(e.modelValue.slice(0)),{parent:s}=f(te),{children:c,linkChildren:u}=I(G);u();const r=m((()=>function(e){return i({text:"text",value:"value",children:"children"},e)}(e.columnsFieldNames))),v=m((()=>T(e.optionHeight))),p=m((()=>function(e,t){const l=e[0];if(l){if(Array.isArray(l))return"multiple";if(t.children in l)return"cascade"}return"default"}(e.columns,r.value))),g=m((()=>{const{columns:t}=e;switch(p.value){case"multiple":return t;case"cascade":return function(e,t,l){const o=[];let a={[t.children]:e},i=0;for(;a&&a[t.children];){const e=a[t.children],s=l.value[i];a=n(s)?Y(e,s,t):void 0,!a&&e.length&&(a=Y(e,F(e)[t.value],t)),i++,o.push(e)}return o}(t,r.value,a);default:return[t]}})),y=m((()=>g.value.some((e=>e.length)))),O=m((()=>g.value.map(((e,t)=>Y(e,a.value[t],r.value))))),k=m((()=>g.value.map(((e,t)=>e.findIndex((e=>e[r.value.value]===a.value[t])))))),H=(e,t)=>{if(a.value[e]!==t){const l=a.value.slice(0);l[e]=t,a.value=l}},$=()=>({selectedValues:a.value.slice(0),selectedOptions:O.value,selectedIndexes:k.value}),P=()=>{c.forEach((e=>e.stopMomentum()));const e=$();return V((()=>{t("confirm",e)})),e},j=()=>t("cancel",$()),L=()=>g.value.map(((o,n)=>w(J,{value:a.value[n],fields:r.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:v.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:e=>((e,l)=>{H(l,e),"cascade"===p.value&&a.value.forEach(((e,t)=>{const l=g.value[t];X(l,e,r.value)||H(t,l.length?l[0][r.value.value]:void 0)})),V((()=>{t("change",i({columnIndex:l},$()))}))})(e,n),onClickOption:e=>((e,l)=>{const o={columnIndex:l,currentOption:e};t("clickOption",i($(),o)),t("scrollInto",o)})(e,n),onScrollInto:e=>{t("scrollInto",{currentOption:e,columnIndex:n})}},{option:l.option}))),A=e=>{if(y.value){const t={height:`${v.value}px`},l={backgroundSize:`100% ${(e-v.value)/2}px`};return[w("div",{class:E("mask"),style:l},null),w("div",{class:[M,E("frame")],style:t},null)]}},z=()=>{const t=v.value*+e.visibleOptionNum,l={height:`${t}px`};return w("div",{ref:o,class:E("columns"),style:l},[L(),A(t)])},_=()=>{if(e.showToolbar&&!s)return w(W,D(C(e,U),{onConfirm:P,onCancel:j}),C(l,R))};let q;N(g,(e=>{e.forEach(((e,t)=>{e.length&&!X(e,a.value[t],r.value)&&H(t,F(e)[r.value.value])}))}),{immediate:!0}),N((()=>e.modelValue),(e=>{S(e,a.value)||S(e,q)||(a.value=e.slice(0),q=e.slice(0))}),{deep:!0}),N(a,(l=>{S(l,e.modelValue)||(q=l.slice(0),t("update:modelValue",q))}),{immediate:!0}),b("touchmove",x,{target:o});return h({confirm:P,getSelectedOptions:()=>O.value}),()=>{var t,o;return w("div",{class:E()},["top"===e.toolbarPosition?_():null,e.loading?w(B,{class:E("loading")},null):null,null==(t=l["columns-top"])?void 0:t.call(l),z(),null==(o=l["columns-bottom"])?void 0:o.call(l),"bottom"===e.toolbarPosition?_():null])}}}));export{oe as P,j as u};
