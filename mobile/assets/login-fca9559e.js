var H=(e,o,n)=>new Promise((l,c)=>{var f=m=>{try{a(n.next(m))}catch(h){c(h)}},u=m=>{try{a(n.throw(m))}catch(h){c(h)}},a=m=>m.done?l(m.value):Promise.resolve(m.value).then(f,u);a((n=n.apply(e,o)).next())});import{c as U,i as He,e as A,a as se,d as B,n as Y,m as K,b as G,r as P,u as Ae,f as I,g as xe,h as ue,w as Fe,j as Oe,k as s,p as re,H as pe,l as z,t as ie,o as Le,q as Pe,s as Re,v as te,x as ne,L as Ue,y as ge,z as Ke,A as _e,B as Ye,C as Ve,F as ze,D as je,E as qe,G as j,I as Ge,J as We,K as y,M as W,N as Ee,O as Je,P as J,Q,R as w,S as M,T as X,U as me,V as de,W as Qe,X as he,Y as Xe,Z as fe,_ as Ze,$ as $e,a0 as et,a1 as tt,a2 as nt,a3 as ot,a4 as at,a5 as be,a6 as lt,a7 as st,a8 as ye,a9 as oe,aa as ae,ab as it}from"./index-cfff818e.js";import{B as Z,F as ct,C as ut,R as rt}from"./index-06aaefce.js";import{S as mt}from"./index-25573ae3.js";import{C as dt}from"./index-9c4ccd22.js";/* empty css              */import"./index-879175f8.js";import{N as ft}from"./index-2bfb6d57.js";import"./use-route-aaae6c4d.js";import"./use-placeholder-07215835.js";const[vt,E,we]=U("picker"),Ie=e=>e.find(o=>!o.disabled)||e[0];function pt(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function q(e,o){o=se(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ke=(e,o,n)=>o!==void 0&&!!e.find(l=>l[n.value]===o);function ce(e,o,n){const l=e.findIndex(f=>f[n.value]===o),c=q(e,l);return e[c]}function gt(e,o,n){const l=[];let c={[o.children]:e},f=0;for(;c&&c[o.children];){const u=c[o.children],a=n.value[f];if(c=He(a)?ce(u,a,o):void 0,!c&&u.length){const m=Ie(u)[o.value];c=ce(u,m,o)}f++,l.push(u)}return l}function _t(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function ht(e){return A({text:"text",value:"value",children:"children"},e)}const Te=200,Ce=300,bt=15,[Be,le]=U("picker-column"),Me=Symbol(Be);var yt=B({name:Be,props:{value:Y,fields:K(Object),options:G(),readonly:Boolean,allowHtml:Boolean,optionHeight:K(Number),swipeDuration:K(Y),visibleOptionNum:K(Y)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:n}){let l,c,f,u,a;const m=P(),h=P(),g=P(0),d=P(0),O=Ae(),C=()=>e.options.length,V=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,S=_=>{let t=q(e.options,_);const r=-t*e.optionHeight,v=()=>{t>C()-1&&(t=q(e.options,_));const $=e.options[t][e.fields.value];$!==e.value&&o("change",$)};l&&r!==g.value?a=v:v(),g.value=r},i=()=>e.readonly||!e.options.length,p=_=>{l||i()||(a=null,d.value=Te,S(_),o("clickOption",e.options[_]))},b=_=>se(Math.round(-_/e.optionHeight),0,C()-1),T=I(()=>b(g.value)),k=(_,t)=>{const r=Math.abs(_/t);_=g.value+r/.003*(_<0?-1:1);const v=b(_);d.value=+e.swipeDuration,S(v)},x=()=>{l=!1,d.value=0,a&&(a(),a=null)},F=_=>{if(!i()){if(O.start(_),l){const t=_t(h.value);g.value=Math.min(0,t-V())}d.value=0,c=g.value,f=Date.now(),u=c,a=null}},D=_=>{if(i())return;O.move(_),O.isVertical()&&(l=!0,re(_,!0));const t=se(c+O.deltaY.value,-(C()*e.optionHeight),e.optionHeight),r=b(t);r!==T.value&&o("scrollInto",e.options[r]),g.value=t;const v=Date.now();v-f>Ce&&(f=v,u=t)},L=()=>{if(i())return;const _=g.value-u,t=Date.now()-f;if(t<Ce&&Math.abs(_)>bt){k(_,t);return}const v=b(g.value);d.value=Te,S(v),setTimeout(()=>{l=!1},0)},N=()=>{const _={height:`${e.optionHeight}px`};return e.options.map((t,r)=>{const v=t[e.fields.text],{disabled:$}=t,R=t[e.fields.value],De={role:"button",style:_,tabindex:$?-1:0,class:[le("item",{disabled:$,selected:R===e.value}),t.className],onClick:()=>p(r)},Ne={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:v};return s("li",De,[n.option?n.option(t,r):s("div",Ne,null)])})};return xe(Me),ue({stopMomentum:x}),Fe(()=>{const _=l?Math.floor(-g.value/e.optionHeight):e.options.findIndex(v=>v[e.fields.value]===e.value),t=q(e.options,_),r=-t*e.optionHeight;l&&t<_&&x(),g.value=r}),Oe("touchmove",D,{target:m}),()=>s("div",{ref:m,class:le(),onTouchstartPassive:F,onTouchend:L,onTouchcancel:L},[s("ul",{ref:h,style:{transform:`translate3d(0, ${g.value+V()}px, 0)`,transitionDuration:`${d.value}ms`,transitionProperty:d.value?"all":"none"},class:le("wrapper"),onTransitionend:x},[N()])])}});const[wt]=U("picker-toolbar"),ee={title:String,cancelButtonText:String,confirmButtonText:String},kt=["cancel","confirm","title","toolbar"],Tt=Object.keys(ee);var Ct=B({name:wt,props:ee,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const l=()=>{if(n.title)return n.title();if(e.title)return s("div",{class:[E("title"),"van-ellipsis"]},[e.title])},c=()=>o("cancel"),f=()=>o("confirm"),u=()=>{const m=e.cancelButtonText||we("cancel");return s("button",{type:"button",class:[E("cancel"),pe],onClick:c},[n.cancel?n.cancel():m])},a=()=>{const m=e.confirmButtonText||we("confirm");return s("button",{type:"button",class:[E("confirm"),pe],onClick:f},[n.confirm?n.confirm():m])};return()=>s("div",{class:E("toolbar")},[n.toolbar?n.toolbar():[u(),l(),a()]])}});const[St,tn]=U("picker-group"),xt=Symbol(St);A({tabs:G(),activeTab:z(0),nextStepText:String},ee);const Ot=A({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:z(44),showToolbar:ie,swipeDuration:z(1e3),visibleOptionNum:z(6)},ee),Pt=A({},Ot,{columns:G(),modelValue:G(),toolbarPosition:Le("top"),columnsFieldNames:Object});var Vt=B({name:vt,props:Pt,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const l=P(),c=P(e.modelValue.slice(0)),{parent:f}=xe(xt),{children:u,linkChildren:a}=Pe(Me);a();const m=I(()=>ht(e.columnsFieldNames)),h=I(()=>Re(e.optionHeight)),g=I(()=>pt(e.columns,m.value)),d=I(()=>{const{columns:t}=e;switch(g.value){case"multiple":return t;case"cascade":return gt(t,m.value,c);default:return[t]}}),O=I(()=>d.value.some(t=>t.length)),C=I(()=>d.value.map((t,r)=>ce(t,c.value[r],m.value))),V=I(()=>d.value.map((t,r)=>t.findIndex(v=>v[m.value.value]===c.value[r]))),S=(t,r)=>{if(c.value[t]!==r){const v=c.value.slice(0);v[t]=r,c.value=v}},i=()=>({selectedValues:c.value.slice(0),selectedOptions:C.value,selectedIndexes:V.value}),p=(t,r)=>{S(r,t),g.value==="cascade"&&c.value.forEach((v,$)=>{const R=d.value[$];ke(R,v,m.value)||S($,R.length?R[0][m.value.value]:void 0)}),_e(()=>{o("change",A({columnIndex:r},i()))})},b=(t,r)=>{const v={columnIndex:r,currentOption:t};o("clickOption",A(i(),v)),o("scrollInto",v)},T=()=>{u.forEach(r=>r.stopMomentum());const t=i();return _e(()=>{o("confirm",t)}),t},k=()=>o("cancel",i()),x=()=>d.value.map((t,r)=>s(yt,{value:c.value[r],fields:m.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:h.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:v=>p(v,r),onClickOption:v=>b(v,r),onScrollInto:v=>{o("scrollInto",{currentOption:v,columnIndex:r})}},{option:n.option})),F=t=>{if(O.value){const r={height:`${h.value}px`},v={backgroundSize:`100% ${(t-h.value)/2}px`};return[s("div",{class:E("mask"),style:v},null),s("div",{class:[Ye,E("frame")],style:r},null)]}},D=()=>{const t=h.value*+e.visibleOptionNum,r={height:`${t}px`};return s("div",{ref:l,class:E("columns"),style:r},[x(),F(t)])},L=()=>{if(e.showToolbar&&!f)return s(Ct,Ke(ge(e,Tt),{onConfirm:T,onCancel:k}),ge(n,kt))};te(d,t=>{t.forEach((r,v)=>{r.length&&!ke(r,c.value[v],m.value)&&S(v,Ie(r)[m.value.value])})},{immediate:!0});let N;return te(()=>e.modelValue,t=>{!ne(t,c.value)&&!ne(t,N)&&(c.value=t.slice(0),N=t.slice(0))},{deep:!0}),te(c,t=>{ne(t,e.modelValue)||(N=t.slice(0),o("update:modelValue",N))},{immediate:!0}),Oe("touchmove",re,{target:l}),ue({confirm:T,getSelectedOptions:()=>C.value}),()=>{var t,r;return s("div",{class:E()},[e.toolbarPosition==="top"?L():null,e.loading?s(Ue,{class:E("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),D(),(r=n["columns-bottom"])==null?void 0:r.call(n),e.toolbarPosition==="bottom"?L():null])}}});const ve=Ve(Vt),[Et,$t]=U("form"),It={colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:Y,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:ie,showErrorMessage:ie,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Bt=B({name:Et,props:It,emits:["submit","failed"],setup(e,{emit:o,slots:n}){const{children:l,linkChildren:c}=Pe(ze),f=i=>i?l.filter(p=>i.includes(p.name)):l,u=i=>new Promise((p,b)=>{const T=[];f(i).reduce((x,F)=>x.then(()=>{if(!T.length)return F.validate().then(D=>{D&&T.push(D)})}),Promise.resolve()).then(()=>{T.length?b(T):p()})}),a=i=>new Promise((p,b)=>{const T=f(i);Promise.all(T.map(k=>k.validate())).then(k=>{k=k.filter(Boolean),k.length?b(k):p()})}),m=i=>{const p=l.find(b=>b.name===i);return p?new Promise((b,T)=>{p.validate().then(k=>{k?T(k):b()})}):Promise.reject()},h=i=>typeof i=="string"?m(i):e.validateFirst?u(i):a(i),g=i=>{typeof i=="string"&&(i=[i]),f(i).forEach(b=>{b.resetValidation()})},d=()=>l.reduce((i,p)=>(i[p.name]=p.getValidationStatus(),i),{}),O=(i,p)=>{l.some(b=>b.name===i?(b.$el.scrollIntoView(p),!0):!1)},C=()=>l.reduce((i,p)=>(p.name!==void 0&&(i[p.name]=p.formValue.value),i),{}),V=()=>{const i=C();h().then(()=>o("submit",i)).catch(p=>{o("failed",{values:i,errors:p}),e.scrollToError&&p[0].name&&O(p[0].name)})},S=i=>{re(i),V()};return c({props:e}),ue({submit:V,validate:h,getValues:C,scrollToField:O,resetValidation:g,getValidationStatus:d}),()=>{var i;return s("form",{class:$t(),onSubmit:S},[(i=n.default)==null?void 0:i.call(n)])}}});const Mt=Ve(Bt),Dt=e=>H(void 0,null,function*(){j.mode==="legacy"?j.global.locale=e:j.global.locale.value=e}),Nt=e=>H(void 0,null,function*(){j.global.setLocaleMessage(e,yield Ge(e))}),Ht=e=>H(void 0,null,function*(){yield je().setLocale(e),yield Nt(e),yield Dt(e),yield qe(e)}),At=()=>({changeLocale:Ht});function Se(e){return typeof e=="function"?e():y(e)}function Ft(e=!1,o={}){const{truthyValue:n=!0,falsyValue:l=!1}=o,c=We(e),f=P(e);function u(a){if(arguments.length)return f.value=a,f.value;{const m=Se(n);return f.value=f.value===m?Se(l):m,f.value}}return c?u:[f,u]}const Lt=B({__name:"DarkPicker",setup(e){const{t:o}=W(),n=Ee(),l=P(!1),c=Je.map(u=>({text:u.title,value:u.strategy})),f=u=>{if(l.value=!1,de(u.selectedValues)){const a=Qe(u.selectedValues[0]);n.setDarkStrategy(a),n.setDark(he(a)),Xe(he(a))}};return(u,a)=>{const m=Z,h=ve,g=fe;return J(),Q(me,null,[s(m,{plain:"",hairline:"",type:"primary",size:"small",onClick:a[0]||(a[0]=d=>l.value=!0)},{default:w(()=>[M(X(y(o)("common.label_dark_mode")),1)]),_:1}),s(g,{show:l.value,"onUpdate:show":a[2]||(a[2]=d=>l.value=d),round:"",position:"bottom"},{default:w(()=>[s(h,{columns:y(c),onConfirm:f,onCancel:a[1]||(a[1]=d=>l.value=!1)},null,8,["columns"])]),_:1},8,["show"])],64)}}}),Rt=B({__name:"LocalePicker",setup(e){const{t:o}=W(),{changeLocale:n}=At(),l=P(!1),c=Ze.map(u=>({text:u.title,value:u.locale})),f=u=>{$e(u),l.value=!1,de(u.selectedValues)&&n(et(u.selectedValues[0])).then()};return(u,a)=>{const m=Z,h=ve,g=fe;return J(),Q(me,null,[s(m,{plain:"",hairline:"",type:"primary",size:"small",onClick:a[0]||(a[0]=d=>l.value=!0)},{default:w(()=>[M(X(y(o)("common.label_language")),1)]),_:1}),s(g,{show:l.value,"onUpdate:show":a[2]||(a[2]=d=>l.value=d),round:"",position:"bottom"},{default:w(()=>[s(h,{columns:y(c),onConfirm:f,onCancel:a[1]||(a[1]=d=>l.value=!1)},null,8,["columns"])]),_:1},8,["show"])],64)}}}),Ut=B({__name:"ThemePicker",setup(e){const{t:o}=W(),n=Ee(),l=P(!1),c=tt.map(u=>({text:u.title,value:u.theme})),f=u=>{l.value=!1,de(u.selectedValues)&&n.setTheme(nt(u.selectedValues[0]))};return(u,a)=>{const m=Z,h=ve,g=fe;return J(),Q(me,null,[s(m,{plain:"",hairline:"",type:"primary",size:"small",onClick:a[0]||(a[0]=d=>l.value=!0)},{default:w(()=>[M(X(y(o)("common.label_theme")),1)]),_:1}),s(g,{show:l.value,"onUpdate:show":a[2]||(a[2]=d=>l.value=d),round:"",position:"bottom"},{default:w(()=>[s(h,{columns:y(c),onConfirm:f,onCancel:a[1]||(a[1]=d=>l.value=!1)},null,8,["columns"])]),_:1},8,["show"])],64)}}}),Kt={class:"mt-6"},Yt={class:"my-2"},nn=B({__name:"login",setup(e){const{t:o}=W(),n=ot(),l=at(),[c,f]=Ft(!1),u=P(),a=be(lt),m=be({username:[{required:!0,message:"Please input username"}],password:[{required:!0,message:"Please input password"}]}),h=()=>H(this,null,function*(){yield u.value.validate(),n.login(a).then(()=>{l.push("/")})});return st(()=>H(this,null,function*(){$e("Page <<Login>> mounted.")})),(g,d)=>{const O=ft,C=it,V=ct,S=Z,i=dt,p=mt,b=ut,T=rt,k=Mt;return J(),Q("div",null,[s(O,{title:y(o)("common.title")},null,8,["title"]),ye("div",Kt,[s(k,{ref_key:"form",ref:u},{default:w(()=>[s(i,{inset:""},{default:w(()=>[s(V,{modelValue:a.username,"onUpdate:modelValue":d[0]||(d[0]=x=>a.username=x),placeholder:y(o)("common.user_field_username"),rules:m.username},{default:w(()=>[oe(g.$slots,"left-icon",{},()=>[s(C,null,{default:w(()=>[s(y(ae),{icon:"ion:person-outline"})]),_:1})])]),_:3},8,["modelValue","placeholder","rules"]),s(V,{modelValue:a.password,"onUpdate:modelValue":d[2]||(d[2]=x=>a.password=x),placeholder:y(o)("common.user_field_password"),rules:m.password,type:y(c)?"password":"text"},{default:w(()=>[oe(g.$slots,"left-icon",{},()=>[s(C,null,{default:w(()=>[s(y(ae),{icon:"ion:lock-closed-outline"})]),_:1})]),oe(g.$slots,"right-icon",{},()=>[s(C,{name:y(c)?"closed-eye":"eye",onClick:d[1]||(d[1]=x=>y(f)(!y(c)))},null,8,["name"]),M(" , "),s(C,null,{default:w(()=>[s(y(ae),{icon:"ion:lock-closed-outline"})]),_:1})])]),_:3},8,["modelValue","placeholder","rules","type"]),ye("div",Yt,[s(S,{onClick:h,type:"primary",block:""},{default:w(()=>[M(X(y(o)("common.button_login")),1)]),_:1})])]),_:3}),s(T,{class:"px-4 pt-4"},{default:w(()=>[s(b,{span:"12",class:"text-left"},{default:w(()=>[s(p,null,{default:w(()=>[s(y(Rt)),s(y(Lt)),s(y(Ut))]),_:1})]),_:1}),s(b,{span:"12",class:"text-right"},{default:w(()=>[s(S,{size:"small"},{default:w(()=>[M("忘记密码")]),_:1}),s(S,{size:"small"},{default:w(()=>[M("注册")]),_:1})]),_:1})]),_:1})]),_:3},512)])])}}});export{nn as default};
