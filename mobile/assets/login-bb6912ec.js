var R=(e,t,n)=>new Promise((c,o)=>{var i=u=>{try{f(n.next(u))}catch(y){o(y)}},d=u=>{try{f(n.throw(u))}catch(y){o(y)}},f=u=>u.done?c(u.value):Promise.resolve(u.value).then(i,d);f((n=n.apply(e,t)).next())});import{u as Ye,s as qe,i as W,l as Ge,n as L,t as N,a as Be,o as We,b as De,c as Ze,w as F,g as Je,p as q,r as T,d as H,e as _,f as te,h as l,T as _e,j as $,k as Qe,m as fe,q as Ve,v as Me,x as ne,y as Z,z as V,A as ie,B as me,C as Xe,D as et,E as tt,F as oe,G as nt,H as Ne,I as re,J as G,K as ee,L as Ae,M as ot,N as J,O as Le,P as at,Q as se,R as ye,S as lt,U as st,V as ct,W as U,X as Y,Y as ve,Z as it,_ as $e,$ as rt,a0 as ut,a1 as be,a2 as dt,a3 as ft,a4 as mt,a5 as vt,a6 as ht,a7 as gt,a8 as pe,a9 as Ce,aa as yt,ab as bt}from"./index-2f4826c0.js";import{u as ae,L as pt,B as z,F as we,R as Ct,C as Se}from"./index-6c242c90.js";import{u as Re}from"./use-touch-e05b7c32.js";import{P as wt}from"./on-popup-reopen-9cb8fb53.js";import{I as Q}from"./index-50e62c77.js";import{c as St}from"./interceptor-07d5cfda.js";import{H as ue,B as Ot,F as kt}from"./constant-72a8536f.js";import{N as Tt}from"./index-ab4af570.js";import{C as It}from"./index-8c839afb.js";import{S as xt}from"./index-77a8136a.js";import"./use-route-fa3ddbce.js";import"./index-beaabd42.js";import"./use-placeholder-17014ae7.js";const Pt=e=>R(void 0,null,function*(){W.mode==="legacy"?W.global.locale=e:W.global.locale.value=e}),Et=e=>R(void 0,null,function*(){W.global.setLocaleMessage(e,yield Ge(e))}),Bt=e=>R(void 0,null,function*(){yield Ye().setLocale(e),yield Et(e),yield Pt(e),yield qe(e)}),Dt=()=>({changeLocale:Bt}),_t={show:Boolean,zIndex:L,overlay:N,duration:L,teleport:[String,Object],lockScroll:N,lazyRender:N,beforeClose:Function,overlayStyle:Object,overlayClass:Be,transitionAppear:Boolean,closeOnClickOverlay:N};let j=0;const Oe="van-overflow-hidden";function Vt(e,t){const n=Re(),c="01",o="10",i=g=>{n.move(g);const b=n.deltaY.value>0?o:c,x=Je(g.target,e.value),{scrollHeight:S,offsetHeight:P,scrollTop:I}=x;let s="11";I===0?s=P>=S?"00":"01":I+P>=S&&(s="10"),s!=="11"&&n.isVertical()&&!(parseInt(s,2)&parseInt(b,2))&&q(g,!0)},d=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",i,{passive:!1}),j||document.body.classList.add(Oe),j++},f=()=>{j&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",i),j--,j||document.body.classList.remove(Oe))},u=()=>t()&&d(),y=()=>t()&&f();We(u),De(y),Ze(y),F(t,g=>{g?d():f()})}function He(e){const t=T(!1);return F(e,n=>{n&&(t.value=n)},{immediate:!0}),n=>()=>t.value?n():null}const[Mt,Nt]=H("overlay"),At={show:Boolean,zIndex:L,duration:L,className:Be,lockScroll:N,lazyRender:N,customStyle:Object};var Lt=_({name:Mt,props:At,setup(e,{slots:t}){const n=T(),c=He(()=>e.show||!e.lazyRender),o=d=>{e.lockScroll&&q(d,!0)},i=c(()=>{var d;const f=$(Qe(e.zIndex),e.customStyle);return fe(e.duration)&&(f.animationDuration=`${e.duration}s`),Ve(l("div",{ref:n,style:f,class:[Nt(),e.className]},[(d=t.default)==null?void 0:d.call(t)]),[[Me,e.show]])});return te("touchmove",o,{target:n}),()=>l(_e,{name:"van-fade",appear:!0},{default:i})}});const $t=ne(Lt),Rt=$({},_t,{round:Boolean,position:Z("center"),closeIcon:Z("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:Z("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Ht,ke]=H("popup");var Ft=_({name:Ht,inheritAttrs:!1,props:Rt,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:n,slots:c}){let o,i;const d=T(),f=T(),u=He(()=>e.show||!e.lazyRender),y=V(()=>{const p={zIndex:d.value};if(fe(e.duration)){const k=e.position==="center"?"animationDuration":"transitionDuration";p[k]=`${e.duration}s`}return p}),g=()=>{o||(o=!0,d.value=e.zIndex!==void 0?+e.zIndex:nt(),t("open"))},b=()=>{o&&St(e.beforeClose,{done(){o=!1,t("close"),t("update:show",!1)}})},x=p=>{t("clickOverlay",p),e.closeOnClickOverlay&&b()},S=()=>{if(e.overlay)return l($t,{show:e.show,class:e.overlayClass,zIndex:d.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:x},{default:c["overlay-content"]})},P=p=>{t("clickCloseIcon",p),b()},I=()=>{if(e.closeable)return l(Q,{role:"button",tabindex:0,name:e.closeIcon,class:[ke("close-icon",e.closeIconPosition),ue],classPrefix:e.iconPrefix,onClick:P},null)};let s;const v=()=>{s&&clearTimeout(s),s=setTimeout(()=>{t("opened")})},C=()=>t("closed"),O=p=>t("keydown",p),w=u(()=>{var p;const{round:k,position:B,safeAreaInsetTop:D,safeAreaInsetBottom:h}=e;return Ve(l("div",Ne({ref:f,style:y.value,role:"dialog",tabindex:0,class:[ke({round:k,[B]:B}),{"van-safe-area-top":D,"van-safe-area-bottom":h}],onKeydown:O},n),[(p=c.default)==null?void 0:p.call(c),I()]),[[Me,e.show]])}),E=()=>{const{position:p,transition:k,transitionAppear:B}=e,D=p==="center"?"van-fade":`van-popup-slide-${p}`;return l(_e,{name:k||D,appear:B,onAfterEnter:v,onAfterLeave:C},{default:w})};return F(()=>e.show,p=>{p&&!o&&(g(),n.tabindex===0&&ie(()=>{var k;(k=f.value)==null||k.focus()})),!p&&o&&(o=!1,t("close"))}),ae({popupRef:f}),Vt(f,()=>e.show&&e.lockScroll),te("popstate",()=>{e.closeOnPopstate&&(b(),i=!1)}),me(()=>{e.show&&g()}),Xe(()=>{i&&(t("update:show",!0),i=!1)}),De(()=>{e.show&&e.teleport&&(b(),i=!0)}),et(wt,()=>e.show),()=>e.teleport?l(tt,{to:e.teleport},{default:()=>[S(),E()]}):l(oe,null,[S(),E()])}});const he=ne(Ft),[zt,M,Te]=H("picker"),Fe=e=>e.find(t=>!t.disabled)||e[0];function Kt(e,t){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(t.children in n)return"cascade"}return"default"}function X(e,t){t=re(t,0,e.length);for(let n=t;n<e.length;n++)if(!e[n].disabled)return n;for(let n=t-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const Ie=(e,t,n)=>t!==void 0&&!!e.find(c=>c[n.value]===t);function de(e,t,n){const c=e.findIndex(i=>i[n.value]===t),o=X(e,c);return e[o]}function jt(e,t,n){const c=[];let o={[t.children]:e},i=0;for(;o&&o[t.children];){const d=o[t.children],f=n.value[i];if(o=fe(f)?de(d,f,t):void 0,!o&&d.length){const u=Fe(d)[t.value];o=de(d,u,t)}i++,c.push(d)}return c}function Ut(e){const{transform:t}=window.getComputedStyle(e),n=t.slice(7,t.length-1).split(", ")[5];return Number(n)}function Yt(e){return $({text:"text",value:"value",children:"children"},e)}const xe=200,Pe=300,qt=15,[ze,ce]=H("picker-column"),Ke=Symbol(ze);var Gt=_({name:ze,props:{value:L,fields:G(Object),options:ee(),readonly:Boolean,allowHtml:Boolean,optionHeight:G(Number),swipeDuration:G(L),visibleOptionNum:G(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:t,slots:n}){let c,o,i,d,f;const u=T(),y=T(),g=T(0),b=T(0),x=Re(),S=()=>e.options.length,P=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,I=h=>{let a=X(e.options,h);const r=-a*e.optionHeight,m=()=>{a>S()-1&&(a=X(e.options,h));const A=e.options[a][e.fields.value];A!==e.value&&t("change",A)};c&&r!==g.value?f=m:m(),g.value=r},s=()=>e.readonly||!e.options.length,v=h=>{c||s()||(f=null,b.value=xe,I(h),t("clickOption",e.options[h]))},C=h=>re(Math.round(-h/e.optionHeight),0,S()-1),O=V(()=>C(g.value)),w=(h,a)=>{const r=Math.abs(h/a);h=g.value+r/.003*(h<0?-1:1);const m=C(h);b.value=+e.swipeDuration,I(m)},E=()=>{c=!1,b.value=0,f&&(f(),f=null)},p=h=>{if(!s()){if(x.start(h),c){const a=Ut(y.value);g.value=Math.min(0,a-P())}b.value=0,o=g.value,i=Date.now(),d=o,f=null}},k=h=>{if(s())return;x.move(h),x.isVertical()&&(c=!0,q(h,!0));const a=re(o+x.deltaY.value,-(S()*e.optionHeight),e.optionHeight),r=C(a);r!==O.value&&t("scrollInto",e.options[r]),g.value=a;const m=Date.now();m-i>Pe&&(i=m,d=a)},B=()=>{if(s())return;const h=g.value-d,a=Date.now()-i;if(a<Pe&&Math.abs(h)>qt){w(h,a);return}const m=C(g.value);b.value=xe,I(m),setTimeout(()=>{c=!1},0)},D=()=>{const h={height:`${e.optionHeight}px`};return e.options.map((a,r)=>{const m=a[e.fields.text],{disabled:A}=a,K=a[e.fields.value],je={role:"button",style:h,tabindex:A?-1:0,class:[ce("item",{disabled:A,selected:K===e.value}),a.className],onClick:()=>v(r)},Ue={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:m};return l("li",je,[n.option?n.option(a,r):l("div",Ue,null)])})};return Ae(Ke),ae({stopMomentum:E}),ot(()=>{const h=c?Math.floor(-g.value/e.optionHeight):e.options.findIndex(m=>m[e.fields.value]===e.value),a=X(e.options,h),r=-a*e.optionHeight;c&&a<h&&E(),g.value=r}),te("touchmove",k,{target:u}),()=>l("div",{ref:u,class:ce(),onTouchstartPassive:p,onTouchend:B,onTouchcancel:B},[l("ul",{ref:y,style:{transform:`translate3d(0, ${g.value+P()}px, 0)`,transitionDuration:`${b.value}ms`,transitionProperty:b.value?"all":"none"},class:ce("wrapper"),onTransitionend:E},[D()])])}});const[Wt]=H("picker-toolbar"),le={title:String,cancelButtonText:String,confirmButtonText:String},Zt=["cancel","confirm","title","toolbar"],Jt=Object.keys(le);var Qt=_({name:Wt,props:le,emits:["confirm","cancel"],setup(e,{emit:t,slots:n}){const c=()=>{if(n.title)return n.title();if(e.title)return l("div",{class:[M("title"),"van-ellipsis"]},[e.title])},o=()=>t("cancel"),i=()=>t("confirm"),d=()=>{const u=e.cancelButtonText||Te("cancel");return l("button",{type:"button",class:[M("cancel"),ue],onClick:o},[n.cancel?n.cancel():u])},f=()=>{const u=e.confirmButtonText||Te("confirm");return l("button",{type:"button",class:[M("confirm"),ue],onClick:i},[n.confirm?n.confirm():u])};return()=>l("div",{class:M("toolbar")},[n.toolbar?n.toolbar():[d(),c(),f()]])}});const[Xt,En]=H("picker-group"),en=Symbol(Xt);$({tabs:ee(),activeTab:J(0),nextStepText:String},le);const tn=$({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:J(44),showToolbar:N,swipeDuration:J(1e3),visibleOptionNum:J(6)},le),nn=$({},tn,{columns:ee(),modelValue:ee(),toolbarPosition:Z("top"),columnsFieldNames:Object});var on=_({name:zt,props:nn,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:t,slots:n}){const c=T(),o=T(e.modelValue.slice(0)),{parent:i}=Ae(en),{children:d,linkChildren:f}=Le(Ke);f();const u=V(()=>Yt(e.columnsFieldNames)),y=V(()=>at(e.optionHeight)),g=V(()=>Kt(e.columns,u.value)),b=V(()=>{const{columns:a}=e;switch(g.value){case"multiple":return a;case"cascade":return jt(a,u.value,o);default:return[a]}}),x=V(()=>b.value.some(a=>a.length)),S=V(()=>b.value.map((a,r)=>de(a,o.value[r],u.value))),P=V(()=>b.value.map((a,r)=>a.findIndex(m=>m[u.value.value]===o.value[r]))),I=(a,r)=>{if(o.value[a]!==r){const m=o.value.slice(0);m[a]=r,o.value=m}},s=()=>({selectedValues:o.value.slice(0),selectedOptions:S.value,selectedIndexes:P.value}),v=(a,r)=>{I(r,a),g.value==="cascade"&&o.value.forEach((m,A)=>{const K=b.value[A];Ie(K,m,u.value)||I(A,K.length?K[0][u.value.value]:void 0)}),ie(()=>{t("change",$({columnIndex:r},s()))})},C=(a,r)=>{const m={columnIndex:r,currentOption:a};t("clickOption",$(s(),m)),t("scrollInto",m)},O=()=>{d.forEach(r=>r.stopMomentum());const a=s();return ie(()=>{t("confirm",a)}),a},w=()=>t("cancel",s()),E=()=>b.value.map((a,r)=>l(Gt,{value:o.value[r],fields:u.value,options:a,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:y.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:m=>v(m,r),onClickOption:m=>C(m,r),onScrollInto:m=>{t("scrollInto",{currentOption:m,columnIndex:r})}},{option:n.option})),p=a=>{if(x.value){const r={height:`${y.value}px`},m={backgroundSize:`100% ${(a-y.value)/2}px`};return[l("div",{class:M("mask"),style:m},null),l("div",{class:[Ot,M("frame")],style:r},null)]}},k=()=>{const a=y.value*+e.visibleOptionNum,r={height:`${a}px`};return l("div",{ref:c,class:M("columns"),style:r},[E(),p(a)])},B=()=>{if(e.showToolbar&&!i)return l(Qt,Ne(ye(e,Jt),{onConfirm:O,onCancel:w}),ye(n,Zt))};F(b,a=>{a.forEach((r,m)=>{r.length&&!Ie(r,o.value[m],u.value)&&I(m,Fe(r)[u.value.value])})},{immediate:!0});let D;return F(()=>e.modelValue,a=>{!se(a,o.value)&&!se(a,D)&&(o.value=a.slice(0),D=a.slice(0))},{deep:!0}),F(o,a=>{se(a,e.modelValue)||(D=a.slice(0),t("update:modelValue",D))},{immediate:!0}),te("touchmove",q,{target:c}),ae({confirm:O,getSelectedOptions:()=>S.value}),()=>{var a,r;return l("div",{class:M()},[e.toolbarPosition==="top"?B():null,e.loading?l(pt,{class:M("loading")},null):null,(a=n["columns-top"])==null?void 0:a.call(n),k(),(r=n["columns-bottom"])==null?void 0:r.call(n),e.toolbarPosition==="bottom"?B():null])}}});const ge=ne(on),[an,ln]=H("form"),sn={colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:L,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:N,showErrorMessage:N,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var cn=_({name:an,props:sn,emits:["submit","failed"],setup(e,{emit:t,slots:n}){const{children:c,linkChildren:o}=Le(kt),i=s=>s?c.filter(v=>s.includes(v.name)):c,d=s=>new Promise((v,C)=>{const O=[];i(s).reduce((E,p)=>E.then(()=>{if(!O.length)return p.validate().then(k=>{k&&O.push(k)})}),Promise.resolve()).then(()=>{O.length?C(O):v()})}),f=s=>new Promise((v,C)=>{const O=i(s);Promise.all(O.map(w=>w.validate())).then(w=>{w=w.filter(Boolean),w.length?C(w):v()})}),u=s=>{const v=c.find(C=>C.name===s);return v?new Promise((C,O)=>{v.validate().then(w=>{w?O(w):C()})}):Promise.reject()},y=s=>typeof s=="string"?u(s):e.validateFirst?d(s):f(s),g=s=>{typeof s=="string"&&(s=[s]),i(s).forEach(C=>{C.resetValidation()})},b=()=>c.reduce((s,v)=>(s[v.name]=v.getValidationStatus(),s),{}),x=(s,v)=>{c.some(C=>C.name===s?(C.$el.scrollIntoView(v),!0):!1)},S=()=>c.reduce((s,v)=>(v.name!==void 0&&(s[v.name]=v.formValue.value),s),{}),P=()=>{const s=S();y().then(()=>t("submit",s)).catch(v=>{t("failed",{values:s,errors:v}),e.scrollToError&&v[0].name&&x(v[0].name)})},I=s=>{q(s),P()};return o({props:e}),ae({submit:P,validate:y,getValues:S,scrollToField:x,resetValidation:g,getValidationStatus:b}),()=>{var s;return l("form",{class:ln(),onSubmit:I},[(s=n.default)==null?void 0:s.call(n)])}}});const rn=ne(cn);function Ee(e){return typeof e=="function"?e():st(e)}function un(e=!1,t={}){const{truthyValue:n=!0,falsyValue:c=!1}=t,o=lt(e),i=T(e);function d(f){if(arguments.length)return i.value=f,i.value;{const u=Ee(n);return i.value=i.value===u?Ee(c):u,i.value}}return o?d:[i,d]}const dn=_({name:"LocaleSelector",setup(){const{changeLocale:e}=Dt(),t=T(!1),n=ct.map(o=>({text:o.title,value:o.locale})),c=o=>{Y(o),ve(o.selectedValues)&&e(it(o.selectedValues[0])),t.value=!1};return()=>l(oe,null,[l(z,{plain:!0,hairline:!0,square:!0,type:"primary",size:"small",onClick:()=>{t.value=!0}},{default:()=>[U("语言")]}),l(he,{show:t.value,round:!0,position:"bottom"},{default:()=>[l(ge,{columns:n,onConfirm:c,onCancel:()=>{t.value=!1}},null)]})])}}),fn=_({name:"ThemePicker",setup(){const e=$e(),t=T(!1),n=rt.map(o=>({text:o.title,value:o.strategy})),c=o=>{if(Y(o),t.value=!1,ve(o.selectedValues)){const i=ut(o.selectedValues[0]);e.setDarkStrategy(i),e.setDark(be(i)),dt(be(i))}};return()=>l(oe,null,[l(z,{plain:!0,hairline:!0,type:"primary",size:"small",onClick:()=>{t.value=!0}},{default:()=>[U("深色模式")]}),l(he,{show:t.value,round:!0,position:"bottom"},{default:()=>[l(ge,{columns:n,onConfirm:c,onCancel:()=>{t.value=!1}},null)]})])}}),mn=_({name:"ThemeSelector",setup(){const e=$e(),t=T(!1),n=ft.map(o=>({text:o.title,value:o.theme})),c=o=>{Y(o),t.value=!1,ve(o.selectedValues)&&e.setTheme(mt(o.selectedValues[0]))};return me(()=>R(this,null,function*(){Y("Component <<ThemeSelector>> mounted.")})),()=>l(oe,null,[l(z,{plain:!0,hairline:!0,type:"primary",size:"small",onClick:()=>{t.value=!0}},{default:()=>[U("主题")]}),l(he,{show:t.value,round:!0,position:"bottom"},{default:()=>[l(ge,{columns:n,onConfirm:c,onCancel:()=>{t.value=!1}},null)]})])}});function vn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!yt(e)}const Bn=_({name:"Login",setup(){const{t:e}=vt(),t=ht(),n=gt(),[c,o]=un(!1),i=T(),d=pe(bt),f=pe({username:[{required:!0,message:"Please input username"}],password:[{required:!0,message:"Please input password"}]}),u=()=>R(this,null,function*(){yield i.value.validate(),t.login(d).then(()=>{n.push("/")})});return me(()=>R(this,null,function*(){Y("Page <<Login>> mounted.")})),()=>{let y;return l("div",null,[l(Tt,{title:e("common.title")},null),l("div",{class:"mt-6"},[l(rn,{ref:i},{default:()=>[l(It,{inset:!0},{default:()=>[l(we,{modelValue:d.username,placeholder:e("common.user_field_username"),rules:f.username},{leftIcon:()=>l(Q,null,{default:()=>[l(Ce,{icon:"ion:person-outline"},null)]})}),l(we,{modelValue:d.password,placeholder:e("common.user_field_password"),rules:f.password,type:c?"password":"text"},{leftIcon:()=>l(Q,null,{default:()=>[l(Ce,{icon:"ion:lock-closed-outline"},null)]}),rightIcon:()=>l(Q,{name:c?"closed-eye":"eye",onClick:()=>o(!c)},null)}),l("div",{class:"my-2"},[l(z,{onClick:u,type:"primary",block:!0},vn(y=e("common.button_login"))?y:{default:()=>[y]})])]}),l(Ct,{class:"px-4 pt-4"},{default:()=>[l(Se,{span:"12",class:"text-left"},{default:()=>[l(xt,null,{default:()=>[l(dn,null,null),l(fn,null,null),l(mn,null,null)]})]}),l(Se,{span:"12",class:"text-right"},{default:()=>[l(z,{size:"small"},{default:()=>[U("忘记密码")]}),l(z,{size:"small"},{default:()=>[U("注册")]})]})]})]})])])}}});export{Bn as default};
