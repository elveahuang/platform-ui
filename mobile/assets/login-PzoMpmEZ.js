var h=(a,e,s)=>new Promise((_,p)=>{var l=n=>{try{f(s.next(n))}catch(g){p(g)}},m=n=>{try{f(s.throw(n))}catch(g){p(g)}},f=n=>n.done?_(n.value):Promise.resolve(n.value).then(l,m);f((s=s.apply(a,e)).next())});import{d as S,r as y,o as A,l as N,a as w,c as $,w as i,J as P,E as o,b as t,K as z,G as W,L as H,M as J,N as O,O as Q,D as F,y as X,I as Y,B as E,P as k,A as I,F as j,Q as Z,R,S as ee,T as ae,H as oe}from"./index-29QG65Ji.js";import{g as te,C as ne,R as se,_ as re,a as le,b as ce}from"./index-7IcCVbSQ.js";import{S as ie}from"./index-N5kqufQz.js";/* empty css              *//* empty css              */import{C as me}from"./index-qFllKies.js";/* empty css              */import{F as pe,a as ue}from"./index-jRb0vLOR.js";import{N as de}from"./index-ZmyD9gfI.js";/* empty css              */import{I as _e}from"./index-0guW93x9.js";/* empty css                                                                 *//* empty css              *//* empty css              */import{t as fe}from"./toNumber-r3VJ3ZxV.js";import"./useTheme-xRPXPYzg.js";import"./index-AARQ1_lV.js";var T=1/0,he=17976931348623157e292;function ge(a){if(!a)return a===0?a:0;if(a=fe(a),a===T||a===-T){var e=a<0?-1:1;return e*he}return a===a?a:0}function ye(a){var e=ge(a),s=e%1;return e===e?s?e-s:e:0}const ve=S({__name:"CodeCaptcha",props:{width:{type:Number,default:120},height:{type:Number,default:24}},emits:["change"],setup(a,{expose:e,emit:s}){const _=s,p=a,l=y(""),m=()=>h(this,null,function*(){yield te({}).then(n=>{l.value=n.data.image,_("change",n.data.key)})});return e({refresh:()=>h(this,null,function*(){m().then()})}),A(()=>h(this,null,function*(){N("Component <<Captcha>> mounted."),m().then()})),(n,g)=>{const v=_e;return w(),$(v,{alt:n.$t("common.field_captcha"),width:p.width,height:p.height,src:l.value,onClick:m},null,8,["alt","width","height","src"])}}}),we=S({__name:"AppIcon",props:{icon:{type:String,require:!0,default:""}},setup(a){const e=a;return(s,_)=>{const p=z;return w(),$(p,null,{default:i(()=>[t(o(P),{icon:e.icon},null,8,["icon"])]),_:1})}}});function U(a){return typeof a=="function"?a():o(a)}typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;function Ce(a=!1,e={}){const{truthyValue:s=!0,falsyValue:_=!1}=e,p=W(a),l=y(a);function m(f){if(arguments.length)return l.value=f,l.value;{const n=U(s);return l.value=l.value===n?U(_):n,l.value}}return p?m:[l,m]}const Ve=E("div",{class:"app-divider"},null,-1),be={class:"m-4"},Ke=S({__name:"login",setup(a){const{t:e}=H(),{isLoginCaptchaEnabled:s}=J(),{login:_,getUserInfo:p}=O(),l=Q(),[m,f]=Ce(!1),n=y(),g=y(),v=y(!1),u=F(ae),C=F({username:[{required:!0,message:e("common.user_field_username_validation_login")}],password:[{required:!0,message:e("common.user_field_password_validation")}],captchaValue:[{required:s,message:e("common.field_captcha_validation")}]}),G=()=>h(this,null,function*(){yield n.value.validate(),_(u).then(r=>h(this,null,function*(){if(r.access_token&&r.refresh_token){yield p().then(),l.push(Z.app.getLoginSuccessUrl()).then();return}else r!=null&&r.code&&ye(r==null?void 0:r.code)>=1e7?R({message:e(`common.error__${r==null?void 0:r.code}`)}):R({message:e("common.system_error")})})).catch(r=>{N(r)}).finally(()=>{u.captchaKey="",u.captchaValue="",v.value=!1,s&&g.value.refresh()})}),L=r=>h(this,null,function*(){u.captchaKey=r});return A(()=>h(this,null,function*(){N("Page <<Login>> mounted.")})),(r,c)=>{const q=de,V=pe,M=me,b=ee,x=ie,B=ne,D=se,K=ue;return w(),X(j,null,[t(q,{title:o(e)("common.user_pages_login_title"),"left-arrow":"",onClickLeft:c[0]||(c[0]=d=>o(oe)())},null,8,["title"]),Ve,t(K,{ref_key:"form",ref:n,"validate-trigger":"onSubmit"},{default:i(()=>[t(M,{inset:""},{default:i(()=>[t(V,{modelValue:u.username,"onUpdate:modelValue":c[1]||(c[1]=d=>u.username=d),placeholder:o(e)("common.user_field_username"),rules:C.username},null,8,["modelValue","placeholder","rules"]),t(V,{modelValue:u.password,"onUpdate:modelValue":c[3]||(c[3]=d=>u.password=d),placeholder:o(e)("common.user_field_password"),rules:C.password,type:o(m)?"text":"password"},{"right-icon":i(()=>[t(o(we),{onClick:c[2]||(c[2]=d=>o(f)(!o(m))),icon:o(m)?"mdi:eye-off-outline":"mdi:eye-outline"},null,8,["icon"])]),_:1},8,["modelValue","placeholder","rules","type"]),o(s)?(w(),$(V,{key:0,modelValue:u.captchaValue,"onUpdate:modelValue":c[4]||(c[4]=d=>u.captchaValue=d),placeholder:o(e)("common.field_captcha_placeholder"),rules:C.captchaValue},{button:i(()=>[t(o(ve),{ref_key:"captcha",ref:g,onChange:L},null,512)]),_:1},8,["modelValue","placeholder","rules"])):Y("",!0)]),_:1}),E("div",be,[t(b,{onClick:G,type:"primary",block:"",disabled:v.value},{default:i(()=>[k(I(o(e)("common.button_login")),1)]),_:1},8,["disabled"])]),t(D,{class:"px-4 pt-4"},{default:i(()=>[t(B,{span:"12",class:"text-left"},{default:i(()=>[t(x,null,{default:i(()=>[t(o(re)),t(o(le)),t(o(ce))]),_:1})]),_:1}),t(B,{span:"12",class:"text-right"},{default:i(()=>[t(x,null,{default:i(()=>[t(b,{plain:"",hairline:"",type:"primary",size:"small",onClick:c[5]||(c[5]=d=>o(l).push({path:"find-password"}))},{default:i(()=>[k(I(o(e)("common.user_pages_find_password_title")),1)]),_:1}),t(b,{plain:"",hairline:"",type:"primary",size:"small",onClick:c[6]||(c[6]=d=>o(l).push({path:"register"}))},{default:i(()=>[k(I(o(e)("common.user_pages_register_title")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)],64)}}});export{Ke as default};
