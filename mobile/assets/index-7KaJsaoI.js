import{e as ee,d as te,aC as Ce,aK as ne,b as h,n as z,aE as J,t as O,aL as ae,y as ie,aM as Ie,aN as Ee,aO as ke,aP as we,aQ as xe,aD as W,m as Me,aG as Pe,aR as Te,ab as Be,r as q,aF as Ae,g as w,h as Q,aS as Le,aT as Re,C as Fe,aU as N,o as _e,j as Ne,aV as x,aW as X,aX as Oe,av as j,aY as We,ah as ze,aZ as De}from"./index-Dy6tiO9n.js";import{c as $e,C as qe}from"./index--PBhRdnN.js";import{u as je}from"./use-id-B_nY1-6R.js";const[Ke,He]=ee("form"),Ue={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:z,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:J,showErrorMessage:J,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Ye=te({name:Ke,props:Ue,emits:["submit","failed"],setup(t,{emit:r,slots:o}){const{children:u,linkChildren:l}=Ce(ae),d=n=>n?u.filter(s=>n.includes(s.name)):u,A=n=>new Promise((s,m)=>{const C=[];d(n).reduce(($,T)=>$.then(()=>{if(!C.length)return T.validate().then(B=>{B&&C.push(B)})}),Promise.resolve()).then(()=>{C.length?m(C):s()})}),M=n=>new Promise((s,m)=>{const C=d(n);Promise.all(C.map(b=>b.validate())).then(b=>{b=b.filter(Boolean),b.length?m(b):s()})}),y=n=>{const s=u.find(m=>m.name===n);return s?new Promise((m,C)=>{s.validate().then(b=>{b?C(b):m()})}):Promise.reject()},I=n=>typeof n=="string"?y(n):t.validateFirst?A(n):M(n),g=n=>{typeof n=="string"&&(n=[n]),d(n).forEach(m=>{m.resetValidation()})},D=()=>u.reduce((n,s)=>(n[s.name]=s.getValidationStatus(),n),{}),P=(n,s)=>{u.some(m=>m.name===n?(m.$el.scrollIntoView(s),!0):!1)},L=()=>u.reduce((n,s)=>(s.name!==void 0&&(n[s.name]=s.formValue.value),n),{}),R=()=>{const n=L();I().then(()=>r("submit",n)).catch(s=>{r("failed",{values:n,errors:s}),t.scrollToError&&s[0].name&&P(s[0].name)})},k=n=>{O(n),R()};return l({props:t}),ne({submit:R,validate:I,getValues:L,scrollToField:P,resetValidation:g,getValidationStatus:D}),()=>{var n;return h("form",{class:He(),onSubmit:k},[(n=o.default)==null?void 0:n.call(o)])}}});const lt=ie(Ye);function re(t){return Array.isArray(t)?!t.length:t===0?!1:!t}function Ge(t,r){if(re(t)){if(r.required)return!1;if(r.validateEmpty===!1)return!0}return!(r.pattern&&!r.pattern.test(String(t)))}function Je(t,r){return new Promise(o=>{const u=r.validator(t,r);if(ke(u)){u.then(o);return}o(u)})}function Z(t,r){const{message:o}=r;return we(o)?o(t,r):o||""}function Qe({target:t}){t.composing=!0}function p({target:t}){t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}function Xe(t,r){const o=Ie();t.style.height="auto";let u=t.scrollHeight;if(xe(r)){const{maxHeight:l,minHeight:d}=r;l!==void 0&&(u=Math.min(u,l)),d!==void 0&&(u=Math.max(u,d))}u&&(t.style.height=`${u}px`,Ee(o))}function Ze(t){return t==="number"?{type:"text",inputmode:"decimal"}:t==="digit"?{type:"tel",inputmode:"numeric"}:{type:t}}function E(t){return[...t].length}function K(t,r){return[...t].slice(0,r).join("")}const[pe,S]=ee("field"),et={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:z,formatter:Function,clearIcon:W("clear"),modelValue:Me(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:W("focus"),formatTrigger:W("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},tt=Pe({},$e,et,{rows:z,type:W("text"),rules:Array,autosize:[Boolean,Object],labelWidth:z,labelClass:Te,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var nt=te({name:pe,props:tt,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(t,{emit:r,slots:o}){const u=je(),l=Be({status:"unvalidated",focused:!1,validateMessage:""}),d=q(),A=q(),M=q(),{parent:y}=Ae(ae),I=()=>{var e;return String((e=t.modelValue)!=null?e:"")},g=e=>{if(x(t[e]))return t[e];if(y&&x(y.props[e]))return y.props[e]},D=w(()=>{const e=g("readonly");if(t.clearable&&!e){const a=I()!=="",i=t.clearTrigger==="always"||t.clearTrigger==="focus"&&l.focused;return a&&i}return!1}),P=w(()=>M.value&&o.input?M.value():t.modelValue),L=w(()=>{var e;const a=g("required");return a==="auto"?(e=t.rules)==null?void 0:e.some(i=>i.required):a}),R=e=>e.reduce((a,i)=>a.then(()=>{if(l.status==="failed")return;let{value:c}=P;if(i.formatter&&(c=i.formatter(c,i)),!Ge(c,i)){l.status="failed",l.validateMessage=Z(c,i);return}if(i.validator)return re(c)&&i.validateEmpty===!1?void 0:Je(c,i).then(f=>{f&&typeof f=="string"?(l.status="failed",l.validateMessage=f):f===!1&&(l.status="failed",l.validateMessage=Z(c,i))})}),Promise.resolve()),k=()=>{l.status="unvalidated",l.validateMessage=""},n=()=>r("endValidate",{status:l.status,message:l.validateMessage}),s=(e=t.rules)=>new Promise(a=>{k(),e?(r("startValidate"),R(e).then(()=>{l.status==="failed"?(a({name:t.name,message:l.validateMessage}),n()):(l.status="passed",a(),n())})):a()}),m=e=>{if(y&&t.rules){const{validateTrigger:a}=y.props,i=X(a).includes(e),c=t.rules.filter(f=>f.trigger?X(f.trigger).includes(e):i);c.length&&s(c)}},C=e=>{var a;const{maxlength:i}=t;if(x(i)&&E(e)>+i){const c=I();if(c&&E(c)===+i)return c;const f=(a=d.value)==null?void 0:a.selectionEnd;if(l.focused&&f){const v=[...e],V=v.length-+i;return v.splice(f-V,V),v.join("")}return K(e,+i)}return e},b=(e,a="onChange")=>{const i=e;e=C(e);const c=E(i)-E(e);if(t.type==="number"||t.type==="digit"){const v=t.type==="number";e=Oe(e,v,v)}let f=0;if(t.formatter&&a===t.formatTrigger){const{formatter:v,maxlength:V}=t;if(e=v(e),x(V)&&E(e)>+V&&(e=K(e,+V)),d.value&&l.focused){const{selectionEnd:_}=d.value,G=K(i,_);f=E(v(G))-E(G)}}if(d.value&&d.value.value!==e)if(l.focused){let{selectionStart:v,selectionEnd:V}=d.value;if(d.value.value=e,x(v)&&x(V)){const _=E(e);c?(v-=c,V-=c):f&&(v+=f,V+=f),d.value.setSelectionRange(Math.min(v,_),Math.min(V,_))}}else d.value.value=e;e!==t.modelValue&&r("update:modelValue",e)},$=e=>{e.target.composing||b(e.target.value)},T=()=>{var e;return(e=d.value)==null?void 0:e.blur()},B=()=>{var e;return(e=d.value)==null?void 0:e.focus()},F=()=>{const e=d.value;t.type==="textarea"&&t.autosize&&e&&Xe(e,t.autosize)},le=e=>{l.focused=!0,r("focus",e),N(F),g("readonly")&&T()},oe=e=>{l.focused=!1,b(I(),"onBlur"),r("blur",e),!g("readonly")&&(m("onBlur"),N(F),De())},H=e=>r("clickInput",e),se=e=>r("clickLeftIcon",e),ce=e=>r("clickRightIcon",e),ue=e=>{O(e),r("update:modelValue",""),r("clear",e)},U=w(()=>{if(typeof t.error=="boolean")return t.error;if(y&&y.props.showError&&l.status==="failed")return!0}),de=w(()=>{const e=g("labelWidth"),a=g("labelAlign");if(e&&a!=="top")return{width:Q(e)}}),fe=e=>{e.keyCode===13&&(!(y&&y.props.submitOnEnter)&&t.type!=="textarea"&&O(e),t.type==="search"&&T()),r("keypress",e)},Y=()=>t.id||`${u}-input`,ge=()=>l.status,me=()=>{const e=S("control",[g("inputAlign"),{error:U.value,custom:!!o.input,"min-height":t.type==="textarea"&&!t.autosize}]);if(o.input)return h("div",{class:e,onClick:H},[o.input()]);const a={id:Y(),ref:d,name:t.name,rows:t.rows!==void 0?+t.rows:void 0,class:e,disabled:g("disabled"),readonly:g("readonly"),autofocus:t.autofocus,placeholder:t.placeholder,autocomplete:t.autocomplete,autocapitalize:t.autocapitalize,autocorrect:t.autocorrect,enterkeyhint:t.enterkeyhint,spellcheck:t.spellcheck,"aria-labelledby":t.label?`${u}-label`:void 0,onBlur:oe,onFocus:le,onInput:$,onClick:H,onChange:p,onKeypress:fe,onCompositionend:p,onCompositionstart:Qe};return t.type==="textarea"?h("textarea",a,null):h("input",We(Ze(t.type),a),null)},he=()=>{const e=o["left-icon"];if(t.leftIcon||e)return h("div",{class:S("left-icon"),onClick:se},[e?e():h(j,{name:t.leftIcon,classPrefix:t.iconPrefix},null)])},be=()=>{const e=o["right-icon"];if(t.rightIcon||e)return h("div",{class:S("right-icon"),onClick:ce},[e?e():h(j,{name:t.rightIcon,classPrefix:t.iconPrefix},null)])},ve=()=>{if(t.showWordLimit&&t.maxlength){const e=E(I());return h("div",{class:S("word-limit")},[h("span",{class:S("word-num")},[e]),ze("/"),t.maxlength])}},ye=()=>{if(y&&y.props.showErrorMessage===!1)return;const e=t.errorMessage||l.validateMessage;if(e){const a=o["error-message"],i=g("errorMessageAlign");return h("div",{class:S("error-message",i)},[a?a({message:e}):e])}},Se=()=>{const e=g("labelWidth"),a=g("labelAlign"),i=g("colon")?":":"";if(o.label)return[o.label(),i];if(t.label)return h("label",{id:`${u}-label`,for:o.input?void 0:Y(),onClick:c=>{O(c),B()},style:a==="top"&&e?{width:Q(e)}:void 0},[t.label+i])},Ve=()=>[h("div",{class:S("body")},[me(),D.value&&h(j,{ref:A,name:t.clearIcon,class:S("clear")},null),be(),o.button&&h("div",{class:S("button")},[o.button()])]),ve(),ye()];return ne({blur:T,focus:B,validate:s,formValue:P,resetValidation:k,getValidationStatus:ge}),Le(Re,{customValue:M,resetValidation:k,validateWithTrigger:m}),Fe(()=>t.modelValue,()=>{b(I()),k(),m("onChange"),N(F)}),_e(()=>{b(I(),t.formatTrigger),N(F)}),Ne("touchstart",ue,{target:w(()=>{var e;return(e=A.value)==null?void 0:e.$el})}),()=>{const e=g("disabled"),a=g("labelAlign"),i=he(),c=()=>{const f=Se();return a==="top"?[i,f].filter(Boolean):f||[]};return h(qe,{size:t.size,class:S({error:U.value,disabled:e,[`label-${a}`]:a}),center:t.center,border:t.border,isLink:t.isLink,clickable:t.clickable,titleStyle:de.value,valueClass:S("value"),titleClass:[S("label",[a,{required:L.value}]),t.labelClass],arrowDirection:t.arrowDirection},{icon:i&&a!=="top"?()=>i:null,title:c,value:Ve,extra:o.extra})}}});const ot=ie(nt);export{lt as F,ot as a};
