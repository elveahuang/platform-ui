var d=(o,e,i)=>new Promise((h,u)=>{var _=s=>{try{g(i.next(s))}catch(f){u(f)}},c=s=>{try{g(i.throw(s))}catch(f){u(f)}},g=s=>s.done?h(s.value):Promise.resolve(s.value).then(_,c);g((i=i.apply(o,e)).next())});import{d as U,r as w,o as A,l as N,a as $,c as E,a2 as K,A as P,a6 as H,a7 as O,H as B,y as Q,b as t,O as a,w as l,a1 as X,G as L,a3 as b,V as k,Q as Y,a8 as j,a4 as S,a5 as J,a9 as W,a0 as Z}from"./index-pyS-jaTs.js";import{C as ee,R as ae}from"./index-yFe7y7OT.js";import{S as oe}from"./index-xidWLv3q.js";/* empty css              *//* empty css                                                                 *//* empty css              *//* empty css              */import{F as te,a as ne}from"./index-07gBjG2u.js";import{N as se}from"./index-OSWY0qnD.js";/* empty css              */import{g as re}from"./captcha-GBL6ap-N.js";import{I as ie}from"./index-SY5lNxNV.js";/* empty css              */import{_ as le,a as me,b as ce}from"./ThemePicker.vue_vue_type_script_setup_true_lang-vHFbiSM7.js";import{_ as pe}from"./AppIcon.vue_vue_type_script_setup_true_lang-R3Vlhcw7.js";import{t as de}from"./toNumber-hBKmNCJo.js";import{u as _e}from"./index-BcEL7lzc.js";import{C as ue}from"./index-DNHVO5Wz.js";import"./index-QQK-Ut9J.js";import"./use-id-zCBKX6Jo.js";import"./useTheme-lBms5cVm.js";var F=1/0,fe=17976931348623157e292;function ge(o){if(!o)return o===0?o:0;if(o=de(o),o===F||o===-F){var e=o<0?-1:1;return e*fe}return o===o?o:0}function he(o){var e=ge(o),i=e%1;return e===e?i?e-i:e:0}const ye=U({__name:"CodeCaptcha",props:{width:{type:Number,default:120},height:{type:Number,default:24}},emits:["change"],setup(o,{expose:e,emit:i}){const h=i,u=o,_=w(""),c=()=>d(this,null,function*(){yield re({}).then(s=>{_.value=s.data.image,h("change",s.data.key)})});return e({refresh:()=>d(this,null,function*(){c().then()})}),A(()=>d(this,null,function*(){N("Component <<Captcha>> mounted."),c().then()})),(s,f)=>{const y=ie;return $(),E(y,{alt:s.$t("common.field_captcha"),width:u.width,height:u.height,src:_.value,onClick:c},null,8,["alt","width","height","src"])}}}),we=L("div",{class:"app-divider"},null,-1),ve={class:"m-4"},Ke=U({__name:"login",setup(o){const{t:e}=K(),{isLoginCaptchaEnabled:i}=P(),{login:h,getUserInfo:u}=H(),_=O(),[c,g]=_e(!1),s=w(),f=w(),y=w(!1),m=B(W),v=B({username:[{required:!0,message:e("common.user_field_username_validation_login")}],password:[{required:!0,message:e("common.user_field_password_validation")}],captchaValue:[{required:i,message:e("common.field_captcha_validation")}]}),R=n=>d(this,null,function*(){N(n)}),T=()=>d(this,null,function*(){y.value=!0,h(m).then(n=>d(this,null,function*(){n.access_token&&n.refresh_token?(yield u().then(),_.push(j.app.getLoginSuccessUrl()).then()):n!=null&&n.code&&he(n==null?void 0:n.code)>=1e7?S({message:e(`common.error__${n==null?void 0:n.code}`)}):S({message:e("common.system_error")})})).finally(()=>{y.value=!1,i&&(m.captchaKey="",m.captchaValue="",f.value.refresh())})}),q=n=>d(this,null,function*(){m.captchaKey=n});return A(()=>d(this,null,function*(){N("Page <<Login>> mounted.")})),(n,r)=>{const G=se,C=te,M=ue,V=J,x=oe,I=ee,z=ae,D=ne;return $(),Q(Y,null,[t(G,{title:a(e)("common.user_pages_login_title"),"left-arrow":"",onClickLeft:r[0]||(r[0]=p=>a(Z)("/tabs/welcome"))},null,8,["title"]),we,t(D,{ref_key:"form",ref:s,"validate-trigger":"onSubmit",onSubmit:T,onFailed:R},{default:l(()=>[t(M,{inset:""},{default:l(()=>[t(C,{modelValue:m.username,"onUpdate:modelValue":r[1]||(r[1]=p=>m.username=p),placeholder:a(e)("common.user_field_username"),rules:v.username},null,8,["modelValue","placeholder","rules"]),t(C,{modelValue:m.password,"onUpdate:modelValue":r[3]||(r[3]=p=>m.password=p),placeholder:a(e)("common.user_field_password"),rules:v.password,type:a(c)?"text":"password"},{"right-icon":l(()=>[t(a(pe),{onClick:r[2]||(r[2]=p=>a(g)(!a(c))),icon:a(c)?"mdi:eye-off-outline":"mdi:eye-outline"},null,8,["icon"])]),_:1},8,["modelValue","placeholder","rules","type"]),a(i)?($(),E(C,{key:0,modelValue:m.captchaValue,"onUpdate:modelValue":r[4]||(r[4]=p=>m.captchaValue=p),placeholder:a(e)("common.field_captcha_placeholder"),rules:v.captchaValue},{button:l(()=>[t(a(ye),{ref_key:"captcha",ref:f,onChange:q},null,512)]),_:1},8,["modelValue","placeholder","rules"])):X("",!0)]),_:1}),L("div",ve,[t(V,{block:"","native-type":"submit",type:"primary",disabled:y.value},{default:l(()=>[b(k(a(e)("common.button_login")),1)]),_:1},8,["disabled"])]),t(z,{class:"px-4 pt-4"},{default:l(()=>[t(I,{span:"12",class:"text-left"},{default:l(()=>[t(x,null,{default:l(()=>[t(a(le)),t(a(me)),t(a(ce))]),_:1})]),_:1}),t(I,{span:"12",class:"text-right"},{default:l(()=>[t(x,null,{default:l(()=>[t(V,{plain:"",hairline:"",type:"primary",size:"small",onClick:r[5]||(r[5]=p=>a(_).push({path:"find-password"}))},{default:l(()=>[b(k(a(e)("common.user_pages_find_password_title")),1)]),_:1}),t(V,{plain:"",hairline:"",type:"primary",size:"small",onClick:r[6]||(r[6]=p=>a(_).push({path:"register"}))},{default:l(()=>[b(k(a(e)("common.user_pages_register_title")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)],64)}}});export{Ke as default};
