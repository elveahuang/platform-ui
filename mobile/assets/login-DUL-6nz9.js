var d=(o,a,i)=>new Promise((g,u)=>{var _=s=>{try{h(i.next(s))}catch(f){u(f)}},c=s=>{try{h(i.throw(s))}catch(f){u(f)}},h=s=>s.done?g(s.value):Promise.resolve(s.value).then(_,c);h((i=i.apply(o,a)).next())});import{d as U,r as w,o as q,l as N,a as $,ag as A,af as K,A as P,an as H,ao as X,ab as B,c as Y,b as t,u as e,w as l,F as j,H as E,ap as J,am as F,aq as O,ad as Q,ae as W,ah as V,ai as k,al as Z}from"./index-CeLFf6qY.js";import{C as ee,R as ae}from"./index-D-iaoQcD.js";import{S as oe}from"./index-BlCcbjVk.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import{F as te,a as ne}from"./index-DswNA08C.js";import{N as se}from"./index-wEXKS0Wl.js";/* empty css              */import{c as re,_ as ie,a as le,b as me}from"./ThemePicker.vue_vue_type_script_setup_true_lang-CvPrTApa.js";import{I as ce}from"./index-2VxfdwpF.js";/* empty css                                                                      *//* empty css              */import{_ as pe}from"./Icon.vue_vue_type_script_setup_true_lang-CDjwZjqH.js";import{t as de}from"./toNumber-HqCGrJHJ.js";import{u as _e}from"./index-DbK2LTZ5.js";import{C as ue}from"./index-BmoAj7zf.js";import"./index-Bzyd1ckS.js";import"./use-id-DoGZR2xO.js";import"./useTheme-D8R3wPgQ.js";var S=1/0,fe=17976931348623157e292;function he(o){if(!o)return o===0?o:0;if(o=de(o),o===S||o===-S){var a=o<0?-1:1;return a*fe}return o===o?o:0}function ge(o){var a=he(o),i=a%1;return a===a?i?a-i:a:0}const ye=U({__name:"CodeCaptcha",props:{width:{type:Number,default:120},height:{type:Number,default:24}},emits:["change"],setup(o,{expose:a,emit:i}){const g=i,u=o,_=w(""),c=()=>d(this,null,function*(){yield re({}).then(s=>{_.value=s.data.image,g("change",s.data.key)})});return a({refresh:()=>d(this,null,function*(){c().then()})}),q(()=>d(this,null,function*(){N("Component <<Captcha>> mounted."),c().then()})),(s,f)=>{const y=ce;return $(),A(y,{alt:s.$t("common.field_captcha"),width:u.width,height:u.height,src:_.value,onClick:c},null,8,["alt","width","height","src"])}}}),we=E("div",{class:"app-divider"},null,-1),Ce={class:"m-4"},Ke=U({__name:"login",setup(o){const{t:a}=K(),{isLoginCaptchaEnabled:i}=P(),{login:g,getUserInfo:u}=H(),_=X(),[c,h]=_e(!1),s=w(),f=w(),y=w(!1),m=B(O),C=B({username:[{required:!0,message:a("common.user_field_username_validation_login")}],password:[{required:!0,message:a("common.user_field_password_validation")}],captchaValue:[{required:i,message:a("common.field_captcha_validation")}]}),L=n=>d(this,null,function*(){N(n)}),R=()=>d(this,null,function*(){y.value=!0,g(m).then(n=>d(this,null,function*(){n.access_token&&n.refresh_token?(yield u().then(),_.push(J.app.getLoginSuccessUrl()).then()):n!=null&&n.code&&ge(n==null?void 0:n.code)>=1e7?F({message:a(`common.error__${n==null?void 0:n.code}`)}):F({message:a("common.system_error")})})).finally(()=>{y.value=!1,i&&(m.captchaKey="",m.captchaValue="",f.value.refresh())})}),T=n=>d(this,null,function*(){m.captchaKey=n});return q(()=>d(this,null,function*(){N("Page <<Login>> mounted.")})),(n,r)=>{const M=se,v=ne,z=ue,b=Z,x=oe,I=ee,D=ae,G=te;return $(),Y(j,null,[t(M,{title:e(a)("common.user_pages_login_title"),"left-arrow":"",onClickLeft:r[0]||(r[0]=p=>e(Q)("/tabs/welcome"))},null,8,["title"]),we,t(G,{ref_key:"form",ref:s,"validate-trigger":"onSubmit",onSubmit:R,onFailed:L},{default:l(()=>[t(z,{inset:""},{default:l(()=>[t(v,{modelValue:e(m).username,"onUpdate:modelValue":r[1]||(r[1]=p=>e(m).username=p),placeholder:e(a)("common.user_field_username"),rules:e(C).username},null,8,["modelValue","placeholder","rules"]),t(v,{modelValue:e(m).password,"onUpdate:modelValue":r[3]||(r[3]=p=>e(m).password=p),placeholder:e(a)("common.user_field_password"),rules:e(C).password,type:e(c)?"text":"password"},{"right-icon":l(()=>[t(e(pe),{icon:e(c)?"mdi:eye-off-outline":"mdi:eye-outline",onClick:r[2]||(r[2]=p=>e(h)(!e(c)))},null,8,["icon"])]),_:1},8,["modelValue","placeholder","rules","type"]),e(i)?($(),A(v,{key:0,modelValue:e(m).captchaValue,"onUpdate:modelValue":r[4]||(r[4]=p=>e(m).captchaValue=p),placeholder:e(a)("common.field_captcha_placeholder"),rules:e(C).captchaValue},{button:l(()=>[t(e(ye),{ref_key:"captcha",ref:f,onChange:T},null,512)]),_:1},8,["modelValue","placeholder","rules"])):W("",!0)]),_:1}),E("div",Ce,[t(b,{block:"","native-type":"submit",type:"primary",disabled:e(y)},{default:l(()=>[V(k(e(a)("common.button_login")),1)]),_:1},8,["disabled"])]),t(D,{class:"px-4 pt-4"},{default:l(()=>[t(I,{span:"12",class:"text-left"},{default:l(()=>[t(x,null,{default:l(()=>[t(e(ie)),t(e(le)),t(e(me))]),_:1})]),_:1}),t(I,{span:"12",class:"text-right"},{default:l(()=>[t(x,null,{default:l(()=>[t(b,{plain:"",hairline:"",type:"primary",size:"small",onClick:r[5]||(r[5]=p=>e(_).push({path:"find-password"}))},{default:l(()=>[V(k(e(a)("common.user_pages_find_password_title")),1)]),_:1}),t(b,{plain:"",hairline:"",type:"primary",size:"small",onClick:r[6]||(r[6]=p=>e(_).push({path:"register"}))},{default:l(()=>[V(k(e(a)("common.user_pages_register_title")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)],64)}}});export{Ke as default};
