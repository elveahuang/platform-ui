var y=(e,n,a)=>new Promise((u,s)=>{var d=c=>{try{r(a.next(c))}catch(g){s(g)}},m=c=>{try{r(a.throw(c))}catch(g){s(g)}},r=c=>c.done?u(c.value):Promise.resolve(c.value).then(d,m);r((a=a.apply(e,n)).next())});import{S as A,aF as he,ak as D,aA as W,d as J,a3 as G,aW as _,aX as L,k as E,a4 as ge,C as O,ao as se,Y as ce,aY as be,Z as ie,h as v,a5 as ue,aZ as Q,T as B,V as pe,U as Te,af as Oe,a_ as ke,G as Z,a$ as q,a1 as ye,_ as ee,b0 as te,ad as Se,b1 as Ce,a2 as xe,b2 as R,b3 as we,b4 as Ee,b5 as V,b6 as De}from"./index-bUmP8Zmg.js";const[Ie,p,ne]=A("picker"),re=e=>e.find(n=>!n.disabled)||e[0];function Me(e,n){const a=e[0];if(a){if(Array.isArray(a))return"multiple";if(n.children in a)return"cascade"}return"default"}function $(e,n){n=W(n,0,e.length);for(let a=n;a<e.length;a++)if(!e[a].disabled)return a;for(let a=n-1;a>=0;a--)if(!e[a].disabled)return a;return 0}const ae=(e,n,a)=>n!==void 0&&!!e.find(u=>u[a.value]===n);function X(e,n,a){const u=e.findIndex(d=>d[a.value]===n),s=$(e,u);return e[s]}function Pe(e,n,a){const u=[];let s={[n.children]:e},d=0;for(;s&&s[n.children];){const m=s[n.children],r=a.value[d];if(s=he(r)?X(m,r,n):void 0,!s&&m.length){const c=re(m)[n.value];s=X(m,c,n)}d++,u.push(m)}return u}function He(e){const{transform:n}=window.getComputedStyle(e),a=n.slice(7,n.length-1).split(", ")[5];return Number(a)}function Ne(e){return D({text:"text",value:"value",children:"children"},e)}const oe=200,le=300,_e=15,[de,z]=A("picker-column"),me=Symbol(de);var Be=J({name:de,props:{value:G,fields:_(Object),options:L(),readonly:Boolean,allowHtml:Boolean,optionHeight:_(Number),swipeDuration:_(G),visibleOptionNum:_(G)},emits:["change","clickOption","scrollInto"],setup(e,{emit:n,slots:a}){let u,s,d,m,r;const c=E(),g=E(),f=E(0),h=E(0),S=ge(),C=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=i=>{let t=$(e.options,i);const o=-t*e.optionHeight,l=()=>{t>C()-1&&(t=$(e.options,i));const T=e.options[t][e.fields.value];T!==e.value&&n("change",T)};u&&o!==f.value?r=l:l(),f.value=o},b=()=>e.readonly||!e.options.length,F=i=>{u||b()||(r=null,h.value=oe,k(i),n("clickOption",e.options[i]))},x=i=>W(Math.round(-i/e.optionHeight),0,C()-1),N=O(()=>x(f.value)),U=(i,t)=>{const o=Math.abs(i/t);i=f.value+o/.003*(i<0?-1:1);const l=x(i);h.value=+e.swipeDuration,k(l)},I=()=>{u=!1,h.value=0,r&&(r(),r=null)},K=i=>{if(!b()){if(S.start(i),u){const t=He(g.value);f.value=Math.min(0,t-H())}h.value=0,s=f.value,d=Date.now(),m=s,r=null}},j=i=>{if(b())return;S.move(i),S.isVertical()&&(u=!0,ue(i,!0));const t=W(s+S.deltaY.value,-(C()*e.optionHeight),e.optionHeight),o=x(t);o!==N.value&&n("scrollInto",e.options[o]),f.value=t;const l=Date.now();l-d>le&&(d=l,m=t)},M=()=>{if(b())return;const i=f.value-m,t=Date.now()-d;if(t<le&&Math.abs(i)>_e){U(i,t);return}const l=x(f.value);h.value=oe,k(l),setTimeout(()=>{u=!1},0)},w=()=>{const i={height:`${e.optionHeight}px`};return e.options.map((t,o)=>{const l=t[e.fields.text],{disabled:T}=t,P=t[e.fields.value],fe={role:"button",style:i,tabindex:T?-1:0,class:[z("item",{disabled:T,selected:P===e.value}),t.className],onClick:()=>F(o)},ve={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return v("li",fe,[a.option?a.option(t,o):v("div",ve,null)])})};return se(me),ce({stopMomentum:I}),be(()=>{const i=u?Math.floor(-f.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=$(e.options,i),o=-t*e.optionHeight;u&&t<i&&I(),f.value=o}),ie("touchmove",j,{target:c}),()=>v("div",{ref:c,class:z(),onTouchstartPassive:K,onTouchend:M,onTouchcancel:M},[v("ul",{ref:g,style:{transform:`translate3d(0, ${f.value+H()}px, 0)`,transitionDuration:`${h.value}ms`,transitionProperty:h.value?"all":"none"},class:z("wrapper"),onTransitionend:I},[w()])])}});const[Ve]=A("picker-toolbar"),Y={title:String,cancelButtonText:String,confirmButtonText:String},$e=["cancel","confirm","title","toolbar"],Le=Object.keys(Y);var Ae=J({name:Ve,props:Y,emits:["confirm","cancel"],setup(e,{emit:n,slots:a}){const u=()=>{if(a.title)return a.title();if(e.title)return v("div",{class:[p("title"),"van-ellipsis"]},[e.title])},s=()=>n("cancel"),d=()=>n("confirm"),m=()=>{const c=e.cancelButtonText||ne("cancel");return v("button",{type:"button",class:[p("cancel"),Q],onClick:s},[a.cancel?a.cancel():c])},r=()=>{const c=e.confirmButtonText||ne("confirm");return v("button",{type:"button",class:[p("confirm"),Q],onClick:d},[a.confirm?a.confirm():c])};return()=>v("div",{class:p("toolbar")},[a.toolbar?a.toolbar():[m(),u(),r()]])}});const[Re,Qe]=A("picker-group"),Ye=Symbol(Re);D({tabs:L(),activeTab:B(0),nextStepText:String},Y);const Fe=D({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:B(44),showToolbar:pe,swipeDuration:B(1e3),visibleOptionNum:B(6)},Y),Ue=D({},Fe,{columns:L(),modelValue:L(),toolbarPosition:Te("top"),columnsFieldNames:Object});var Ke=J({name:Ie,props:Ue,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:n,slots:a}){const u=E(),s=E(e.modelValue.slice(0)),{parent:d}=se(Ye),{children:m,linkChildren:r}=Oe(me);r();const c=O(()=>Ne(e.columnsFieldNames)),g=O(()=>ke(e.optionHeight)),f=O(()=>Me(e.columns,c.value)),h=O(()=>{const{columns:t}=e;switch(f.value){case"multiple":return t;case"cascade":return Pe(t,c.value,s);default:return[t]}}),S=O(()=>h.value.some(t=>t.length)),C=O(()=>h.value.map((t,o)=>X(t,s.value[o],c.value))),H=O(()=>h.value.map((t,o)=>t.findIndex(l=>l[c.value.value]===s.value[o]))),k=(t,o)=>{if(s.value[t]!==o){const l=s.value.slice(0);l[t]=o,s.value=l}},b=()=>({selectedValues:s.value.slice(0),selectedOptions:C.value,selectedIndexes:H.value}),F=(t,o)=>{k(o,t),f.value==="cascade"&&s.value.forEach((l,T)=>{const P=h.value[T];ae(P,l,c.value)||k(T,P.length?P[0][c.value.value]:void 0)}),ee(()=>{n("change",D({columnIndex:o},b()))})},x=(t,o)=>{const l={columnIndex:o,currentOption:t};n("clickOption",D(b(),l)),n("scrollInto",l)},N=()=>{m.forEach(o=>o.stopMomentum());const t=b();return ee(()=>{n("confirm",t)}),t},U=()=>n("cancel",b()),I=()=>h.value.map((t,o)=>v(Be,{value:s.value[o],fields:c.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:g.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>F(l,o),onClickOption:l=>x(l,o),onScrollInto:l=>{n("scrollInto",{currentOption:l,columnIndex:o})}},{option:a.option})),K=t=>{if(S.value){const o={height:`${g.value}px`},l={backgroundSize:`100% ${(t-g.value)/2}px`};return[v("div",{class:p("mask"),style:l},null),v("div",{class:[Ce,p("frame")],style:o},null)]}},j=()=>{const t=g.value*+e.visibleOptionNum,o={height:`${t}px`};return v("div",{ref:u,class:p("columns"),style:o},[I(),K(t)])},M=()=>{if(e.showToolbar&&!d)return v(Ae,Se(te(e,Le),{onConfirm:N,onCancel:U}),te(a,$e))};Z(h,t=>{t.forEach((o,l)=>{o.length&&!ae(o,s.value[l],c.value)&&k(l,re(o)[c.value.value])})},{immediate:!0});let w;return Z(()=>e.modelValue,t=>{!q(t,s.value)&&!q(t,w)&&(s.value=t.slice(0),w=t.slice(0))},{deep:!0}),Z(s,t=>{q(t,e.modelValue)||(w=t.slice(0),n("update:modelValue",w))},{immediate:!0}),ie("touchmove",ue,{target:u}),ce({confirm:N,getSelectedOptions:()=>C.value}),()=>{var t,o;return v("div",{class:p()},[e.toolbarPosition==="top"?M():null,e.loading?v(ye,{class:p("loading")},null):null,(t=a["columns-top"])==null?void 0:t.call(a),j(),(o=a["columns-bottom"])==null?void 0:o.call(a),e.toolbarPosition==="bottom"?M():null])}}});const et=xe(Ke),je=e=>y(void 0,null,function*(){R().setDark(e)}),Ge=e=>y(void 0,null,function*(){const n=R();n.setDarkMode(e),n.setDark(we(e))}),tt=()=>({setDark:je,setDarkMode:Ge}),Ze=e=>y(void 0,null,function*(){V.mode==="legacy"?V.global.locale=e:V.global.locale.value=e}),qe=e=>y(void 0,null,function*(){V.global.setLocaleMessage(e,yield De(e))}),ze=e=>y(void 0,null,function*(){yield R().setLocale(e),yield qe(e),yield Ze(e),yield Ee(e)}),nt=()=>({setLocale:ze}),We=e=>y(void 0,null,function*(){R().setTheme(e)}),at=()=>({setTheme:We});export{et as P,nt as a,at as b,tt as u};
