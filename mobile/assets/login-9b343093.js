var f=(c,o,i)=>new Promise((p,u)=>{var l=t=>{try{d(i.next(t))}catch(s){u(s)}},m=t=>{try{d(i.throw(t))}catch(s){u(s)}},d=t=>t.done?p(t.value):Promise.resolve(t.value).then(l,m);d((i=i.apply(c,o)).next())});import{d as U,r as v,o as G,l as B,a as q,c as A,G as E,E as a,J as L,K as M,L as W,D as I,y as J,b as e,A as x,w as n,M as V,N as b,B as k,O,P as Q,Q as $,R as j}from"./index-b8efec62.js";import{g as H,C as X,R as Y,_ as Z,a as ee,b as ae}from"./index-91d38f7f.js";import{S as te}from"./index-99ab6837.js";/* empty css              *//* empty css              */import{C as oe}from"./index-ba25a823.js";/* empty css              */import{F as ne,a as se}from"./index-ae76203c.js";import{N as le}from"./index-ad411b46.js";/* empty css              */import{I as re}from"./index-70db6003.js";/* empty css                                                                 *//* empty css              *//* empty css              */import"./useTheme-81e1d620.js";import"./index-74cfa6f0.js";const ce=U({__name:"CodeCaptcha",props:{width:{type:Number,default:120},height:{type:Number,default:24}},emits:["change"],setup(c,{expose:o,emit:i}){const p=i,u=c,l=v(""),m=()=>f(this,null,function*(){yield H({}).then(t=>{l.value=t.data.image,p("change",t.data.key)})});return o({refresh:()=>f(this,null,function*(){m().then()})}),G(()=>f(this,null,function*(){B("Component <<Captcha>> mounted."),m().then()})),(t,s)=>{const g=re;return q(),A(g,{alt:t.$t("common.field_captcha"),width:u.width,height:u.height,src:l.value,onClick:m},null,8,["alt","width","height","src"])}}});function R(c){return typeof c=="function"?c():a(c)}typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;function ie(c=!1,o={}){const{truthyValue:i=!0,falsyValue:p=!1}=o,u=E(c),l=v(c);function m(d){if(arguments.length)return l.value=d,l.value;{const t=R(i);return l.value=l.value===t?R(p):t,l.value}}return u?m:[l,m]}const ue={class:"mt-6"},me={class:"m-4"},Ie=U({__name:"login",setup(c){const{t:o}=L(),i=M(),p=W(),[u,l]=ie(!1),m=v(),d=v(),t=v(!1),s=I(Q),g=I({username:[{required:!0,message:o("common.user_field_username_validation_login")}],password:[{required:!0,message:o("common.user_field_password_validation")}],captchaValue:[{required:!0,message:o("common.field_captcha_validation")}]}),D=()=>f(this,null,function*(){yield m.value.validate(),i.login(s).then(()=>f(this,null,function*(){yield i.getUserInfo().then(),p.push("/").then()})).catch(h=>{B(h),d.value.refresh()}).finally(()=>{s.captchaKey="",s.captchaValue="",t.value=!1})}),F=h=>f(this,null,function*(){s.captchaKey=h});return G(()=>f(this,null,function*(){B("Page <<Login>> mounted.")})),(h,r)=>{const K=le,y=j,w=ne,P=oe,C=O,N=te,S=X,T=Y,z=se;return q(),J("div",null,[e(K,{title:a(o)("common.title")},null,8,["title"]),x("div",ue,[e(z,{ref_key:"form",ref:m},{default:n(()=>[e(P,{inset:""},{default:n(()=>[e(w,{modelValue:s.username,"onUpdate:modelValue":r[0]||(r[0]=_=>s.username=_),placeholder:a(o)("common.user_field_username"),rules:g.username},{default:n(()=>[V(h.$slots,"left-icon",{},()=>[e(y,null,{default:n(()=>[e(a($),{icon:"ion:person-outline"})]),_:1})])]),_:3},8,["modelValue","placeholder","rules"]),e(w,{modelValue:s.password,"onUpdate:modelValue":r[2]||(r[2]=_=>s.password=_),placeholder:a(o)("common.user_field_password"),rules:g.password,type:a(u)?"password":"text"},{default:n(()=>[V(h.$slots,"left-icon",{},()=>[e(y,null,{default:n(()=>[e(a($),{icon:"ion:lock-closed-outline"})]),_:1})]),V(h.$slots,"right-icon",{},()=>[e(y,{name:a(u)?"closed-eye":"eye",onClick:r[1]||(r[1]=_=>a(l)(!a(u)))},null,8,["name"]),e(y,null,{default:n(()=>[e(a($),{icon:"ion:lock-closed-outline"})]),_:1})])]),_:3},8,["modelValue","placeholder","rules","type"]),e(w,{modelValue:s.captchaValue,"onUpdate:modelValue":r[3]||(r[3]=_=>s.captchaValue=_),placeholder:a(o)("common.field_captcha_placeholder"),rules:g.captchaValue},{button:n(()=>[e(a(ce),{ref_key:"captcha",ref:d,onChange:F},null,512)]),_:1},8,["modelValue","placeholder","rules"])]),_:3}),x("div",me,[e(C,{onClick:D,type:"primary",block:"",disabled:t.value},{default:n(()=>[b(k(a(o)("common.button_login")),1)]),_:1},8,["disabled"])]),e(T,{class:"px-4 pt-4"},{default:n(()=>[e(S,{span:"12",class:"text-left"},{default:n(()=>[e(N,null,{default:n(()=>[e(a(Z)),e(a(ee)),e(a(ae))]),_:1})]),_:1}),e(S,{span:"12",class:"text-right"},{default:n(()=>[e(N,null,{default:n(()=>[e(C,{plain:"",hairline:"",type:"primary",size:"small",onClick:r[4]||(r[4]=_=>a(p).push({path:"find-password"}))},{default:n(()=>[b(k(a(o)("common.user_pages_find_password_title")),1)]),_:1}),e(C,{plain:"",hairline:"",type:"primary",size:"small",onClick:r[5]||(r[5]=_=>a(p).push({path:"register"}))},{default:n(()=>[b(k(a(o)("common.user_pages_register_title")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:3},512)])])}}});export{Ie as default};
