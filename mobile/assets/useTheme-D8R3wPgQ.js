var p=(e,a,n)=>new Promise((u,s)=>{var m=c=>{try{r(n.next(c))}catch(d){s(d)}},f=c=>{try{r(n.throw(c))}catch(d){s(d)}},r=c=>c.done?u(c.value):Promise.resolve(c.value).then(m,f);r((n=n.apply(e,a)).next())});import{e as R,aV as be,aG as I,x as Q,d as X,n as G,bi as _,b7 as L,r as D,f as ge,g as k,aF as se,aK as ce,bu as Te,j as ie,b as h,t as ue,ba as Z,m as B,aE as re,aD as Oe,aC as ke,bk as ye,C as q,k as z,bb as pe,aU as ee,b9 as te,aY as Ce,bI as xe,y as we,bJ as A,bK as Ee,bL as De,bM as V,bN as Ie}from"./index-CeLFf6qY.js";const[Me,T,ne]=R("picker"),de=e=>e.find(a=>!a.disabled)||e[0];function Pe(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function $(e,a){a=Q(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ae=(e,a,n)=>a!==void 0&&!!e.find(u=>u[n.value]===a);function W(e,a,n){const u=e.findIndex(m=>m[n.value]===a),s=$(e,u);return e[s]}function Se(e,a,n){const u=[];let s={[a.children]:e},m=0;for(;s&&s[a.children];){const f=s[a.children],r=n.value[m];if(s=be(r)?W(f,r,a):void 0,!s&&f.length){const c=de(f)[a.value];s=W(f,c,a)}m++,u.push(f)}return u}function He(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function Ne(e){return I({text:"text",value:"value",children:"children"},e)}const oe=200,le=300,_e=15,[me,J]=R("picker-column"),fe=Symbol(me);var Be=X({name:me,props:{value:G,fields:_(Object),options:L(),readonly:Boolean,allowHtml:Boolean,optionHeight:_(Number),swipeDuration:_(G),visibleOptionNum:_(G)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let u,s,m,f,r;const c=D(),d=D(),v=D(0),b=D(0),C=ge(),x=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,y=i=>{let t=$(e.options,i);const o=-t*e.optionHeight,l=()=>{t>x()-1&&(t=$(e.options,i));const O=e.options[t][e.fields.value];O!==e.value&&a("change",O)};u&&o!==v.value?r=l:l(),v.value=o},g=()=>e.readonly||!e.options.length,F=i=>{u||g()||(r=null,b.value=oe,y(i),a("clickOption",e.options[i]))},w=i=>Q(Math.round(-i/e.optionHeight),0,x()-1),N=k(()=>w(v.value)),U=(i,t)=>{const o=Math.abs(i/t);i=v.value+o/.003*(i<0?-1:1);const l=w(i);b.value=+e.swipeDuration,y(l)},M=()=>{u=!1,b.value=0,r&&(r(),r=null)},Y=i=>{if(!g()){if(C.start(i),u){const t=He(d.value);v.value=Math.min(0,t-H())}b.value=0,s=v.value,m=Date.now(),f=s,r=null}},j=i=>{if(g())return;C.move(i),C.isVertical()&&(u=!0,ue(i,!0));const t=Q(s+C.deltaY.value,-(x()*e.optionHeight),e.optionHeight),o=w(t);o!==N.value&&a("scrollInto",e.options[o]),v.value=t;const l=Date.now();l-m>le&&(m=l,f=t)},P=()=>{if(g())return;const i=v.value-f,t=Date.now()-m;if(t<le&&Math.abs(i)>_e){U(i,t);return}const l=w(v.value);b.value=oe,y(l),setTimeout(()=>{u=!1},0)},E=()=>{const i={height:`${e.optionHeight}px`};return e.options.map((t,o)=>{const l=t[e.fields.text],{disabled:O}=t,S=t[e.fields.value],ve={role:"button",style:i,tabindex:O?-1:0,class:[J("item",{disabled:O,selected:S===e.value}),t.className],onClick:()=>F(o)},he={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return h("li",ve,[n.option?n.option(t,o):h("div",he,null)])})};return se(fe),ce({stopMomentum:M}),Te(()=>{const i=u?Math.floor(-v.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=$(e.options,i),o=-t*e.optionHeight;u&&t<i&&M(),v.value=o}),ie("touchmove",j,{target:c}),()=>h("div",{ref:c,class:J(),onTouchstartPassive:Y,onTouchend:P,onTouchcancel:P},[h("ul",{ref:d,style:{transform:`translate3d(0, ${v.value+H()}px, 0)`,transitionDuration:`${b.value}ms`,transitionProperty:b.value?"all":"none"},class:J("wrapper"),onTransitionend:M},[E()])])}});const[Ve]=R("picker-toolbar"),K={title:String,cancelButtonText:String,confirmButtonText:String},$e=["cancel","confirm","title","toolbar"],Le=Object.keys(K);var Ae=X({name:Ve,props:K,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const u=()=>{if(n.title)return n.title();if(e.title)return h("div",{class:[T("title"),"van-ellipsis"]},[e.title])},s=()=>a("cancel"),m=()=>a("confirm"),f=()=>{var c;const d=(c=e.cancelButtonText)!=null?c:ne("cancel");if(!(!n.cancel&&!d))return h("button",{type:"button",class:[T("cancel"),Z],onClick:s},[n.cancel?n.cancel():d])},r=()=>{var c;const d=(c=e.confirmButtonText)!=null?c:ne("confirm");if(!(!n.confirm&&!d))return h("button",{type:"button",class:[T("confirm"),Z],onClick:m},[n.confirm?n.confirm():d])};return()=>h("div",{class:T("toolbar")},[n.toolbar?n.toolbar():[f(),u(),r()]])}});const[Re,Je]=R("picker-group"),Ke=Symbol(Re);I({tabs:L(),activeTab:B(0),nextStepText:String,showToolbar:re},K);const Fe=I({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:B(44),showToolbar:re,swipeDuration:B(1e3),visibleOptionNum:B(6)},K),Ue=I({},Fe,{columns:L(),modelValue:L(),toolbarPosition:Oe("top"),columnsFieldNames:Object});var Ye=X({name:Me,props:Ue,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const u=D(),s=D(e.modelValue.slice(0)),{parent:m}=se(Ke),{children:f,linkChildren:r}=ke(fe);r();const c=k(()=>Ne(e.columnsFieldNames)),d=k(()=>ye(e.optionHeight)),v=k(()=>Pe(e.columns,c.value)),b=k(()=>{const{columns:t}=e;switch(v.value){case"multiple":return t;case"cascade":return Se(t,c.value,s);default:return[t]}}),C=k(()=>b.value.some(t=>t.length)),x=k(()=>b.value.map((t,o)=>W(t,s.value[o],c.value))),H=k(()=>b.value.map((t,o)=>t.findIndex(l=>l[c.value.value]===s.value[o]))),y=(t,o)=>{if(s.value[t]!==o){const l=s.value.slice(0);l[t]=o,s.value=l}},g=()=>({selectedValues:s.value.slice(0),selectedOptions:x.value,selectedIndexes:H.value}),F=(t,o)=>{y(o,t),v.value==="cascade"&&s.value.forEach((l,O)=>{const S=b.value[O];ae(S,l,c.value)||y(O,S.length?S[0][c.value.value]:void 0)}),ee(()=>{a("change",I({columnIndex:o},g()))})},w=(t,o)=>{const l={columnIndex:o,currentOption:t};a("clickOption",I(g(),l)),a("scrollInto",l)},N=()=>{f.forEach(o=>o.stopMomentum());const t=g();return ee(()=>{a("confirm",t)}),t},U=()=>a("cancel",g()),M=()=>b.value.map((t,o)=>h(Be,{value:s.value[o],fields:c.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:d.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>F(l,o),onClickOption:l=>w(l,o),onScrollInto:l=>{a("scrollInto",{currentOption:l,columnIndex:o})}},{option:n.option})),Y=t=>{if(C.value){const o={height:`${d.value}px`},l={backgroundSize:`100% ${(t-d.value)/2}px`};return[h("div",{class:T("mask"),style:l},null),h("div",{class:[xe,T("frame")],style:o},null)]}},j=()=>{const t=d.value*+e.visibleOptionNum,o={height:`${t}px`};return h("div",{ref:u,class:T("columns"),style:o},[M(),Y(t)])},P=()=>{if(e.showToolbar&&!m)return h(Ae,Ce(te(e,Le),{onConfirm:N,onCancel:U}),te(n,$e))};q(b,t=>{t.forEach((o,l)=>{o.length&&!ae(o,s.value[l],c.value)&&y(l,de(o)[c.value.value])})},{immediate:!0});let E;return q(()=>e.modelValue,t=>{!z(t,s.value)&&!z(t,E)&&(s.value=t.slice(0),E=t.slice(0))},{deep:!0}),q(s,t=>{z(t,e.modelValue)||(E=t.slice(0),a("update:modelValue",E))},{immediate:!0}),ie("touchmove",ue,{target:u}),ce({confirm:N,getSelectedOptions:()=>x.value}),()=>{var t,o;return h("div",{class:T()},[e.toolbarPosition==="top"?P():null,e.loading?h(pe,{class:T("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),j(),(o=n["columns-bottom"])==null?void 0:o.call(n),e.toolbarPosition==="bottom"?P():null])}}});const Qe=we(Ye),We=()=>({setDark:e=>p(void 0,null,function*(){const{setDark:a}=A();a(e)}),setDarkMode:e=>p(void 0,null,function*(){const{setDarkMode:a,setDark:n}=A();a(e),n(Ee(e))})}),je=e=>p(void 0,null,function*(){V.mode==="legacy"?V.global.locale=e:V.global.locale.value=e}),Ge=e=>p(void 0,null,function*(){V.global.setLocaleMessage(e,yield Ie(e))}),Xe=()=>({setLocale:e=>p(void 0,null,function*(){const{setLocale:a}=A();yield Ge(e),yield je(e),a(e),De(e)})}),Ze=()=>({setTheme:e=>p(void 0,null,function*(){const{setTheme:a}=A();a(e)})});export{Qe as P,Xe as a,Ze as b,We as u};
